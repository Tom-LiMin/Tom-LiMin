<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SpringBoot,Vuecli">
    <meta name="description" content="改篇文章是对学习编码onlin-courses中收集的问题以及一些解决方案。
编码注意事项
再次说明，main是静态方法，在静态方法不能直接访问普通方法，静态方法体内能直接访问的就只能是静态方法。

第5章5-9 代码优化Q1
本节中，如果">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>在线课程系统学习中的问题 | Tom leeMin</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Tom leeMin</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Tom leeMin</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/19.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">在线课程系统学习中的问题</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-09-20
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>改篇文章是对学习编码onlin-courses中收集的问题以及一些解决方案。</p>
<h2 id="编码注意事项"><a href="#编码注意事项" class="headerlink" title="编码注意事项"></a>编码注意事项</h2><blockquote>
<p>再次说明，main是静态方法，在静态方法不能直接访问普通方法，静态方法体内能直接访问的就只能是静态方法。</p>
</blockquote>
<h1 id="第5章"><a href="#第5章" class="headerlink" title="第5章"></a>第5章</h1><h2 id="5-9-代码优化"><a href="#5-9-代码优化" class="headerlink" title="5-9 代码优化"></a>5-9 代码优化</h2><h3 id="Q1"><a href="#Q1" class="headerlink" title="Q1"></a>Q1</h3><blockquote>
<p>本节中，如果后端校验不通过，会setMessage(),然后前端显示的时这个messa。	<code>Toast.warning(resp.message)</code></p>
<p>前端vue此时就会显示”名称不能位空“的错误提示。</p>
<p>如果我希望做<strong>中英等多语言版本，</strong><em>请问实现思路应该时怎么样的？</em></p>
<ul>
<li>某同学的一点思路<ul>
<li>1.后端setMessage(“The name cannot be empty”)，前端vue显示该message。</li>
<li>2.后端setCode()而不是setMessage(),前端vue根据code和当前语言显示不同语言的错误提示（<em>建议这种，功能交给前端，减轻服务器压力</em>）</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Q2AOP在server中引用而在顶层pom没引用"><a href="#Q2AOP在server中引用而在顶层pom没引用" class="headerlink" title="Q2	AOP在server中引用而在顶层pom没引用"></a>Q2	AOP在server中引用而在顶层pom没引用</h3><blockquote>
<p><code>描述</code>：server项目pom引入了spring-boot-starter-aop，但没有指定版本，同时根pom.xml也没有看到相关依赖和版本号</p>
<p><u>根pom为什么不需要写spring-boot-starter-aop</u></p>
</blockquote>
<blockquote>
<p><code>answer</code>:根pom.xml里有还有个<strong>parent</strong>，所有的版本号都是官方的parent里定义</p>
</blockquote>
<h3 id="Q3service层设计"><a href="#Q3service层设计" class="headerlink" title="Q3	service层设计"></a>Q3	service层设计</h3><blockquote>
<p><code>描述</code>：传统的项目都是service接口加一层service实现类，<em>至于本项目的思路</em></p>
<p><code>answer</code>:<u>接口一般配合上设计模式，写一些通用逻辑，<em>对于写业务功能没有必要</em></u></p>
<p>传统的项目结构都是service接口加一层service实现类，而且<em>早期Spring时通过接口</em>来<em>实现注入</em>的，</p>
</blockquote>
<h3 id="Q4前端加校验了，为什么后端接口还要加校验？"><a href="#Q4前端加校验了，为什么后端接口还要加校验？" class="headerlink" title="Q4	前端加校验了，为什么后端接口还要加校验？"></a>Q4	前端加校验了，为什么后端接口还要加校验？</h3><blockquote>
<p><code>answer</code>:这是一个安全性的问题，所有前端的校验都是不安全的，可以被绕过，最简单的，黑客不通过界面，而通过postman等工具，可以直接调用后端接口，如果不加校验，后端接口就全敞开了。</p>
<p>前端校验时为了给用户正常的提示，后端接口校验时为了防止恶意用户不用界面，直接调用接口。</p>
<p><em>前后端校验的规则是一样的，只是提示不一样</em> 。<br>前端的提示是具体的错误，后端的提示是模糊的，比如参数错误（但是后端的日志还是要写清楚长度不能超过多少）<br>→<strong>为了安全</strong>，特别是<em>接口是公网对外开放的情况</em>，<u>容易被各种参数探测</u>。</p>
</blockquote>
<h3 id="Q5-如何理解前端的"><a href="#Q5-如何理解前端的" class="headerlink" title="Q5 	如何理解前端的$"></a>Q5 	如何理解前端的$</h3><blockquote>
<p><code>answer</code>:$时jquery的东西，引入jqery.js后，就可以通过$来使用jQuery内置的方法</p>
</blockquote>
<h3 id="Q6通过注解的形式进行后端校验是否可靠主流？"><a href="#Q6通过注解的形式进行后端校验是否可靠主流？" class="headerlink" title="Q6	通过注解的形式进行后端校验是否可靠主流？"></a>Q6	通过注解的形式进行后端校验是否可靠主流？</h3><h3 id="Q7-反射获取业务名称的问题"><a href="#Q7-反射获取业务名称的问题" class="headerlink" title="Q7 反射获取业务名称的问题"></a>Q7 反射获取业务名称的问题</h3><blockquote>
<p>获取业务名称，成员变量必须是<code>public static final</code>吗？<br>以下是我测试的结果：</p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">MEMBER</span> <span class="operator">=</span> <span class="string">&quot;我是成员变量1&quot;</span>;</span><br><span class="line"><span class="comment">//    public static final String MEMBER = &quot;我是成员变量2&quot;;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">helloController</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;helloTest&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AOP</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAOP</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义一个切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.course.*.controller..*Controller.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">controllerPointcut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;controllerPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(<span class="string">&quot;-------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> signature.getDeclaringType();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        String className = signature.getDeclaringTypeName();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println(className);</span></span><br><span class="line"></span><br><span class="line">        String memberName;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getField(<span class="string">&quot;MEMBER&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;field = &quot;</span> + field);</span><br><span class="line">            memberName = (String) field.get(clazz);</span><br><span class="line">            System.out.println(<span class="string">&quot;memberName = &quot;</span> + memberName);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>当MEMBER的声明为<code>public static final String</code>的时候，可以获取到MEMBER的值</strong></p>
<p><strong>当MEMBER的声明为<code>public String</code>的时候，无法获取到MEMBER的值，报错了</strong></p>
<blockquote>
<p><code>answer</code>:这个是java反射的内容。加上static，就需要从类上取值，不加static，就需要从类的对象取值。两种写法不一样</p>
</blockquote>
<h1 id="第6章"><a href="#第6章" class="headerlink" title="第6章"></a>第6章</h1><h2 id="6-1代码生成器关于模板"><a href="#6-1代码生成器关于模板" class="headerlink" title="6-1	代码生成器关于模板"></a>6-1	代码生成器关于模板</h2><blockquote>
<p>为什么要用模板？有了JSTL，还需要freemarker吗？ </p>
<p>   模板技术与容器无关，同样可以应用于非Web应用程序环境。ftl文件改动之后是不需要编译的，这点不同于Jsp 。JSTL只能用在jsp中，修改了jsp，需要重新编译，从而使用模板更有效率。 </p>
</blockquote>
<h2 id="6-2-Controller层和service层代码生成"><a href="#6-2-Controller层和service层代码生成" class="headerlink" title="6-2 Controller层和service层代码生成"></a>6-2 Controller层和service层代码生成</h2><h3 id="Q1为什么dto类不继承entity类"><a href="#Q1为什么dto类不继承entity类" class="headerlink" title="Q1	为什么dto类不继承entity类"></a>Q1	为什么dto类不继承entity类</h3><blockquote>
<p>dto类对象是需要返回给前端页面的，如果继承entity类，entity里边所有的字段属性都会暴露给前端，不利于数据传输安全性</p>
</blockquote>
<blockquote>
<p><img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220722153412345.png" alt="image-20220722153412345"></p>
</blockquote>
<h2 id="6-4前端vue界面代码生成"><a href="#6-4前端vue界面代码生成" class="headerlink" title="6-4	前端vue界面代码生成"></a>6-4	前端vue界面代码生成</h2><blockquote>
<p>看到XxxGenerator.java里的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只生成配置文件中的第一个table节点</span></span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(generatorConfigPath);</span><br><span class="line">SAXReader reader=<span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line"><span class="comment">//读取xml文件到Document中</span></span><br><span class="line">Document doc=reader.read(file);</span><br><span class="line"><span class="comment">//获取xml文件的根节点</span></span><br><span class="line">Element rootElement=doc.getRootElement();</span><br><span class="line"><span class="comment">//读取context节点</span></span><br><span class="line"><span class="type">Element</span> <span class="variable">contextElement</span> <span class="operator">=</span> rootElement.element(<span class="string">&quot;context&quot;</span>);</span><br><span class="line"><span class="comment">//定义一个Element用于遍历</span></span><br><span class="line">Element tableElement;</span><br><span class="line"><span class="comment">//取第一个“table”的节点</span></span><br><span class="line">tableElement=contextElement.elementIterator(<span class="string">&quot;table&quot;</span>).next();</span><br><span class="line"><span class="type">String</span> <span class="variable">Domain</span> <span class="operator">=</span> tableElement.attributeValue(<span class="string">&quot;domainObjectName&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> tableElement.attributeValue(<span class="string">&quot;tableName&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">tableNameCn</span> <span class="operator">=</span> DbUtil.getTableComment(tableName);</span><br><span class="line"><span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> Domain.substring(<span class="number">0</span>, <span class="number">1</span>).toLowerCase() + Domain.substring(<span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;表：&quot;</span>+tableElement.attributeValue(<span class="string">&quot;tableName&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;Domain：&quot;</span>+tableElement.attributeValue(<span class="string">&quot;domainObjectName&quot;</span>));</span><br><span class="line"></span><br><span class="line">List&lt;Field&gt; fieldList = DbUtil.getColumnByTableName(tableName);</span><br><span class="line">Set&lt;String&gt; typeSet = getJavaTypes(fieldList);</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;Domain&quot;</span>,Domain);</span><br><span class="line">map.put(<span class="string">&quot;domain&quot;</span>,domain);</span><br><span class="line">map.put(<span class="string">&quot;tableNameCn&quot;</span>,tableNameCn);</span><br><span class="line">map.put(<span class="string">&quot;module&quot;</span>,MODULE);</span><br><span class="line">map.put(<span class="string">&quot;fieldList&quot;</span>,fieldList);</span><br><span class="line">map.put(<span class="string">&quot;typeSet&quot;</span>,typeSet);</span><br><span class="line"></span><br><span class="line"><span class="comment">//生成dto</span></span><br><span class="line">FreemarkerUtil.initConfig(ftlName);</span><br><span class="line">FreemarkerUtil.generator(toPath+Domain+fileName,map);</span><br></pre></td></tr></table></figure>

<p>出现错误</p>
<blockquote>
<p><img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220723192728870.png" alt="image-20220723192728870"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;原因可能是&#x27;</span>：`方法的参数不能为静态变量`。 实际上：→ vue.ftl后面多加了一个，号</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</blockquote>
</blockquote>
<h3 id="Q1Vue引入组件无法显示且报错"><a href="#Q1Vue引入组件无法显示且报错" class="headerlink" title="Q1	Vue引入组件无法显示且报错"></a>Q1	Vue引入组件无法显示且报错</h3><blockquote>
<h1 id="Vue-warn-Do-not-use-built-in-or-reserved-HTML-elements-as-component-id-section"><a href="#Vue-warn-Do-not-use-built-in-or-reserved-HTML-elements-as-component-id-section" class="headerlink" title="[Vue warn]: Do not use built-in or reserved HTML elements as component id: section"></a>[Vue warn]: Do not use built-in or reserved HTML elements as component id: section</h1></blockquote>
<p>参考·1：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34645412/article/details/78846782">1</a></p>
<p>参考·2：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lxjstudyIT/article/details/81253937?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~default-1-81253937-blog-78846782.pc_relevant_multi_platform_whitelistv2_ad_hc&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~default-1-81253937-blog-78846782.pc_relevant_multi_platform_whitelistv2_ad_hc&utm_relevant_index=1">2</a></p>
<blockquote>
<p>第二个网址的参考挺有价值的。</p>
<p>section.vue里的&lt;script&gt;修改了<code>name</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Pagination</span> <span class="keyword">from</span> <span class="string">&quot;../../components/pagination&quot;</span>;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">components</span>: &#123;<span class="title class_">Pagination</span>&#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;subsection&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">section</span>: &#123;&#125;,</span><br><span class="line">        <span class="attr">sections</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Q2BASE-URL是怎么确定的？"><a href="#Q2BASE-URL是怎么确定的？" class="headerlink" title="Q2	BASE_URL是怎么确定的？"></a>Q2	BASE_URL是怎么确定的？</h3><h2 id="6-5字段校验和通用字段的处理"><a href="#6-5字段校验和通用字段的处理" class="headerlink" title="6-5	字段校验和通用字段的处理"></a>6-5	字段校验和通用字段的处理</h2><h3 id="Q1-Resource注解的问题"><a href="#Q1-Resource注解的问题" class="headerlink" title="Q1 @Resource注解的问题"></a>Q1 @Resource注解的问题</h3><blockquote>
<p><code>描述</code>：有人问他之前都会在持久层加上@Repository注解，然后再service层使用时通过@Resource注解注入，</p>
<p>但再老师的课程中，持久层类没有使用@Repository注解，再service也依然能正常注入。</p>
<p>问→spring是怎么知道持久层的类要实例化？</p>
<blockquote>
<p>BusinessApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.course&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.course.server.mapper&quot;)</span></span><br></pre></td></tr></table></figure>

<p><strong>在启动类里有配置扫描的，所以所有的maper不需要加注解。</strong></p>
</blockquote>
</blockquote>
<h3 id="Q2-为什么将主键设计成char（8）"><a href="#Q2-为什么将主键设计成char（8）" class="headerlink" title="Q2 为什么将主键设计成char（8）"></a>Q2 为什么将主键设计成char（8）</h3><p><strong>自增ID在分布式场景不适用，所有有时候会有32位的uuid来作为主键，但32位太长，所以缩减为8位62进制数，</strong></p>
<h3 id="Q3-在实际工作中场景中，各个模块是分布部署的？那如何管理pom的版本控制？"><a href="#Q3-在实际工作中场景中，各个模块是分布部署的？那如何管理pom的版本控制？" class="headerlink" title="Q3 在实际工作中场景中，各个模块是分布部署的？那如何管理pom的版本控制？"></a>Q3 在实际工作中场景中，各个模块是分布部署的？那如何管理pom的版本控制？</h3><blockquote>
<p><code>描述</code>：实际场景中，eureka，gateway，和业务模块是分开部署在多个服务器上吗？还是都是部署在一个项目里？</p>
<p>如果是部署在多个服务器上，pom的版本控制又是如何管理的？</p>
</blockquote>
<p><code>回答</code>：</p>
<ul>
<li><p>实际是部署在多态机器上。避免连锁反应</p>
</li>
<li><p>根据不同的业务配置不一样的机器数目。（<em>比如淘宝的商品服务，访问量较多，可以配置多一些机器；物流服务，访问少，可以配置少一些机器</em>）</p>
</li>
<li><p>pom只在开发阶段有用，声明这个项目的jar都死hi用什么版本的，<em>打包后这些版本已经固定下来，跟放一起发布还是分开发布没关系。</em></p>
</li>
</ul>
<h3 id="YesNoEnum是测试生成器的"><a href="#YesNoEnum是测试生成器的" class="headerlink" title="YesNoEnum是测试生成器的"></a>YesNoEnum是测试生成器的</h3><h3 id="生成器有点问题"><a href="#生成器有点问题" class="headerlink" title="生成器有点问题"></a>生成器有点问题</h3><blockquote>
<p>生成器生成vue时，对于枚举类型 需要生成后手动修改回来</p>
</blockquote>
<h3 id="Q4-前端时间格式和后端不统一，导致反序列化"><a href="#Q4-前端时间格式和后端不统一，导致反序列化" class="headerlink" title="Q4 前端时间格式和后端不统一，导致反序列化"></a>Q4 前端时间格式和后端不统一，导致反序列化</h3><blockquote>
<p>后端的日期时Date类型的，前端传来的格式时“yyy-MM-dd HH：mm：ss”。</p>
</blockquote>
<ul>
<li>Dto实体类都是有加@JsonFormat注解的。</li>
<li>但Bean→Section  却不用加注解</li>
</ul>
<h2 id="6-7生成器综合示例"><a href="#6-7生成器综合示例" class="headerlink" title="6-7	生成器综合示例"></a>6-7	生成器综合示例</h2><h3 id="Q1-关于使用ftl来制作生成excel的问题"><a href="#Q1-关于使用ftl来制作生成excel的问题" class="headerlink" title="Q1 关于使用ftl来制作生成excel的问题"></a>Q1 关于使用ftl来制作生成excel的问题</h3><blockquote>
<p><code>描诉</code>：如何使用java代码来将xml格式转换成xlsx格式。</p>
<p>在制作模板的时候可以使用excel将xlsx文件另存为xml，使用freemarker替换完成后如何在代码层面将xml文件转换回xlsx文件。</p>
<p>因为如何直接强行更改后缀位xlsx，在是以哦那个excel打开的时候出现警告，如果直接就以xml文件的格式导出的化用户可能不知道如何打开。</p>
</blockquote>
<h3 id="技术扩展："><a href="#技术扩展：" class="headerlink" title="技术扩展："></a>技术扩展：</h3><ul>
<li><strong>自制自己项目的代码生成器</strong>；</li>
<li><strong>导出复杂的excel</strong></li>
<li>生成静态网页</li>
</ul>
<p><u>freemarker的使用核心就是制作模板</u></p>
<h1 id="第7章"><a href="#第7章" class="headerlink" title="第7章"></a>第7章</h1><hr>
<h2 id="7-1课程管理功能开发"><a href="#7-1课程管理功能开发" class="headerlink" title="7-1	课程管理功能开发"></a>7-1	课程管理功能开发</h2><blockquote>
<p>简单的跳转可以用router-link（类似a标签），如果是有其他的操作，可以写个click方法。</p>
<p>比如从课程跳到大章，需要先<strong>缓存课程信息</strong>，所以写click方法。</p>
</blockquote>
<h2 id="Q1-课程管理样式不统一如何调整"><a href="#Q1-课程管理样式不统一如何调整" class="headerlink" title="Q1 课程管理样式不统一如何调整"></a>Q1 课程管理样式不统一如何调整</h2><blockquote>
<p><code>回答</code>：一般封面的尺寸都会有<strong>统一的尺寸</strong>，否则在学生端的显示，手机端的显示都会处问题，</p>
<ul>
<li>像慕课网了，它所有的封面都是统一尺寸的，→这是约定优于配置的一种体现，<strong>按约定来可以降低系统复杂度</strong></li>
<li>如果非要用不同的尺寸，可以考虑给图片区域加个height样式，不管大图小图统一高度。</li>
<li>三个标签更边上有空白，可以将margin-right和padding-right设置为0</li>
</ul>
</blockquote>
<h2 id="7-2-课程时长的保存和显示"><a href="#7-2-课程时长的保存和显示" class="headerlink" title="7-2 课程时长的保存和显示"></a>7-2 课程时长的保存和显示</h2><blockquote>
<p>注意h5缓存（会话缓存和本地缓存）与vue全局变量、json的区别</p>
</blockquote>
<blockquote>
<p><strong>自定义异常一般可以选择继承RuntimeException</strong></p>
</blockquote>
<h2 id="7-3-分页管理功能开发"><a href="#7-3-分页管理功能开发" class="headerlink" title="7-3 分页管理功能开发"></a>7-3 分页管理功能开发</h2><blockquote>
<p>发现个有趣的 问题</p>
<p><img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220803113705674.png" alt="image-20220803113705674"></p>
</blockquote>
<h3 id="Q-老师在课堂上提出的问题"><a href="#Q-老师在课堂上提出的问题" class="headerlink" title="Q 老师在课堂上提出的问题"></a>Q 老师在课堂上提出的问题</h3><blockquote>
<p>问题：新增、编辑、删除二级分类时，没有马上刷新出来，会用到另外一个小知识点</p>
</blockquote>
<p><em>先看前端：</em> <u>修改categoru.vue的方法</u></p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点击【新增一级】</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">add1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">  _this.<span class="property">active</span> = &#123;&#125;;</span><br><span class="line">  _this.<span class="property">level2</span> = [];</span><br><span class="line">  _this.<span class="property">category</span> = &#123;</span><br><span class="line">    <span class="attr">parent</span>: <span class="string">&quot;00000000&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  $(<span class="string">&quot;#form-modal&quot;</span>).<span class="title function_">modal</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点击【新增二级】</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">add2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Tool</span>.<span class="title function_">isEmpty</span>(_this.<span class="property">active</span>)) &#123;</span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">warning</span>(<span class="string">&quot;请先点击一级分类&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  _this.<span class="property">category</span> = &#123;</span><br><span class="line">    <span class="attr">parent</span>: _this.<span class="property">active</span>.<span class="property">id</span></span><br><span class="line">  &#125;;</span><br><span class="line">  $(<span class="string">&quot;.modal&quot;</span>).<span class="title function_">modal</span>(<span class="string">&quot;show&quot;</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Q1-关于设计表的细节"><a href="#Q1-关于设计表的细节" class="headerlink" title="Q1 关于设计表的细节"></a>Q1 关于设计表的细节</h3><blockquote>
<p><code>描述</code>：什么样的数据表，适合使用自定义的uuid，<u>如果数据表数据量特别大，</u>使用自定义的UUID来作为主键是否合适？</p>
<p>​			如果一个库中数据表  都使用自定义的UUID作为id字段，这样设计可以吗？</p>
<p><code>解答</code>：中小项目可以使用UUID，但UUID有个缺点，<u>就是无序</u>，<strong>会影响mysql的性能</strong>，数据量不大时可以忽略这个缺点。</p>
<p>​			ID方案可以研究下：雪花算法</p>
</blockquote>
<h3 id="Q2-形成树形结构的问题"><a href="#Q2-形成树形结构的问题" class="headerlink" title="Q2 形成树形结构的问题"></a>Q2 形成树形结构的问题</h3><blockquote>
<p><code>描述</code>：</p>
<ul>
<li>形成树形结构的代码写在前端会不会不太合理？ </li>
<li>每次都是要完整遍历以便categorys，all()方法每调用一次，就要重新遍历一遍？</li>
<li>还是说all()调用一次后，形成的树形结构会存储起来？</li>
</ul>
</blockquote>
<blockquote>
<p><code>答：</code></p>
<p>​	分类数量本身不大，每次重新九三也不要紧。	当然只计算一次并缓存更好。</p>
</blockquote>
<h3 id="Q3-Vue中使用jQuery"><a href="#Q3-Vue中使用jQuery" class="headerlink" title="Q3 Vue中使用jQuery"></a>Q3 Vue中使用jQuery</h3><blockquote>
<p><code>描述</code>：</p>
<ul>
<li>很多论坛，都对在vue中使用jQuery嗤之以鼻，如何理解</li>
<li>$(“tr.active”).trigger(“click”)  <u>这句话的效果用vue实现有哪些方案</u></li>
</ul>
</blockquote>
<blockquote>
<p><code>答</code>：</p>
<ul>
<li>课程中前端UI用了bootstrap，依赖jQuery，所以不得不用。<u>如果用elementui等vue组件</u>，<em>就不需要jQuery</em></li>
<li>不用jQuery，可以用原生js，<code>document.getElementById(&quot;xxx&quot;).click();</code>, 用vue的话，可以用<code>$emit</code>.</li>
</ul>
</blockquote>
<h3 id="Q4-层级关系"><a href="#Q4-层级关系" class="headerlink" title="Q4 层级关系"></a>Q4 层级关系</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.active</span> <span class="selector-tag">td</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow !importan;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>描述</code>：这个td指的是</p>
</blockquote>
<blockquote>
<p><code>答</code>：是层级关系，为带<u>有active样式</u>的<u>div</u>下面的td设置生效。<strong>子节点，孙节点，子子孙孙节点都有效</strong>。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">div</span> class=&quot;active&quot;&gt;</span><br><span class="line">	&lt;<span class="selector-tag">td</span>&gt; <span class="selector-class">.active</span> <span class="selector-tag">td</span>这里生效，在子节点<span class="selector-tag">td</span>节点也生效 &lt;/<span class="selector-tag">td</span>&gt;</span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Q5-有个bug，删了一级还能添加"><a href="#Q5-有个bug，删了一级还能添加" class="headerlink" title="Q5 有个bug，删了一级还能添加"></a>Q5 有个bug，删了一级还能添加</h3><blockquote>
<p><code>描述</code>：删除选中的一级分类后，应该把当前的选中状态置为空。</p>
</blockquote>
<h2 id="7-4-课程和分类关联保存和显示"><a href="#7-4-课程和分类关联保存和显示" class="headerlink" title="7-4 课程和分类关联保存和显示"></a>7-4 课程和分类关联保存和显示</h2><h3 id="My-Question"><a href="#My-Question" class="headerlink" title="My Question"></a>My Question</h3><blockquote>
<p><code>title</code>:<strong>前端添加课程报错，但刷新后能看到新添加的课程</strong></p>
<p>​		课程分类关联后，除了新增会导致报错，显示500 服务端错误，<strong>Cannot read properties of undefined (reading ‘data’)</strong></p>
<p>​		同时，模态框并未消失<br><img src="https://img.mukewang.com/szimg/62eb8bd4086d441e13440603.jpg" alt="图片描述"><br><em>同时查看network，亦是如此</em><br><img src="https://img.mukewang.com/szimg/62eb944b081b713419200360.jpg" alt="图片描述"></p>
<p>但刷新课程管理后，发现上述的新增后的课程能显示出来</p>
<p>查看后端日志，显示如下<br><img src="https://img.mukewang.com/szimg/62eb94f208749f8d13860696.jpg" alt="图片描述">&#96;</p>
</blockquote>
<blockquote>
<p><code>解答</code>：Service层与mapper层的代码 只能接收 domain层Course类型的参数，而不是dto层的CourseDto</p>
<p><u>缘由</u>：从前端传进来的courseDto没有courId，而courseId由于已经insert过了，就不会出问题。</p>
<p>改saveBatch方法的参数→ 2个参数</p>
<ul>
<li>String courseID	→  course.getId()</li>
<li>List<CategoryDto> →courseDto.getCategorys()</li>
</ul>
<p><img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220804183825225.png" alt="image-20220804183825225"></p>
</blockquote>
<h3 id="理解两个for循环的差别"><a href="#理解两个for循环的差别" class="headerlink" title="理解两个for循环的差别"></a>理解两个for循环的差别</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; dtoList.size(); i++ )&#123;</span><br><span class="line">    # 这种写法，每次循环都会计算dtoList.szie()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>,i = dtoList.size(); i &lt; l; i++ )&#123;</span><br><span class="line">   #这种写法，只会计算一次dtoList.size(),之后每次循环都用变量l</span><br><span class="line">   #在需要大量循环的时候，性能会好一点。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Q2-获取所有分类的这个接口"><a href="#Q2-获取所有分类的这个接口" class="headerlink" title="Q2 获取所有分类的这个接口"></a>Q2 获取所有分类的这个接口</h3><p><code>描述</code>：接口为post，但参数直接拼接在Url上  → 暴露ID没问题，不过查询类的可以用get</p>
<p>​			获取所有的分类	的这个接口的入参可以改成get方法。</p>
<h3 id="Q3-事务的意义"><a href="#Q3-事务的意义" class="headerlink" title="Q3 事务的意义"></a>Q3 事务的意义</h3><blockquote>
<p><code>答</code>：事务时为了保证数据的完整性，不至于保存一半，比如一门课程属于4个分类，需要insert 4 次，</p>
<p>假设insert 2次后，内存溢出了，如果不加事务，库里就会保存进两个分类，显示数据是不完整的，所以需要加个事务，要么4次都成功，要么都不要成功，前端重新保存。</p>
<p>一般有多个SQL操作，就需要增加事务</p>
</blockquote>
<h3 id="Q4-Spring事务的传播机制"><a href="#Q4-Spring事务的传播机制" class="headerlink" title="Q4 Spring事务的传播机制"></a>Q4 Spring事务的传播机制</h3><h3 id="Q5-CourseCategoryExample中如何让修改where条件"><a href="#Q5-CourseCategoryExample中如何让修改where条件" class="headerlink" title="Q5 CourseCategoryExample中如何让修改where条件"></a>Q5 CourseCategoryExample中如何让修改where条件</h3><blockquote>
<p><code>example.createCriteria.andCourseIdEqual(courseId);</code>	→ 该句相当于<code>where course_id = xxx</code>,根据课程ID course_id查所有的章。</p>
</blockquote>
<h2 id="7-5-课程内容功能开发"><a href="#7-5-课程内容功能开发" class="headerlink" title="7-5 课程内容功能开发"></a>7-5 课程内容功能开发</h2><h3 id="Q1浮点数无法传递"><a href="#Q1浮点数无法传递" class="headerlink" title="Q1	浮点数无法传递"></a>Q1	浮点数无法传递</h3><blockquote>
<p><code>描述</code>：我自己常见的表中有些子u但时浮点数类型，利用ajax.get获取时整数的字段能获取成功，但浮点数总时null</p>
<p>再前端表单修改保存到数据库时数据库中也是null，这是为什么？</p>
<p><code>回答</code>：浮点数尽量不要用，有时候写的时10，结果程序时0.99999，<u>用BigDecimal或者转成String更好</u></p>
</blockquote>
<h2 id="Q-如何编写一个jQuery插件"><a href="#Q-如何编写一个jQuery插件" class="headerlink" title="Q 如何编写一个jQuery插件"></a>Q 如何编写一个jQuery插件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#content&quot;</span>).<span class="title function_">summernote</span>(&#123;</span><br><span class="line">   <span class="attr">focus</span>:<span class="literal">true</span>,</span><br><span class="line">   <span class="attr">height</span>:<span class="number">300</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这段js的原理时扫描，JavaScript时如何实现一个普通div有summernote()方法的？</p>
</blockquote>
<h2 id="Q2-如何再课程内容功能开发中添加单选题功能（考试功能）"><a href="#Q2-如何再课程内容功能开发中添加单选题功能（考试功能）" class="headerlink" title="Q2*** 如何再课程内容功能开发中添加单选题功能（考试功能）"></a>Q2*** 如何再课程内容功能开发中添加单选题功能（考试功能）</h2><blockquote>
<p><code>描述</code>：老师 如果我想在课程内容中添加观看完一小节内容需要做一个小测试，这种功能 是新创建一个题库的数据库 还是用 视频里的 课程内容 这个数据库去做呢，这个功能理论上应该是简单的增删改查加判分 但是我也不知道有没有坑，所以想请问下老师，一个好的开发这个功能的流程应该是怎么样的</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>你这个功能不是新增数据库，而是<u>新增表</u>，和小节做关联。<strong>就像课程下面有大章，大章下面有小节，小节下面有试题</strong>。</p>
<p>拆需求，拆成一个一个的功能点，再做数据库设计。数据库模型能满足你的功能点就可以了。</p>
<p>你这个至少需要下面两张表：</p>
<p><em>试题表</em>，关联小节ID，记录题目，选项，答案等（选项可以考虑再单独做成一个表），在admin模块管理</p>
<p><em>作答表</em>，关联试题ID，记录做题人，作答内容，作答结果（得分），计时等</p>
</blockquote>
<h2 id="Q3-对于数据中经常变化的字段，单独分离出来做一个表，是不是叫快照？"><a href="#Q3-对于数据中经常变化的字段，单独分离出来做一个表，是不是叫快照？" class="headerlink" title="Q3 对于数据中经常变化的字段，单独分离出来做一个表，是不是叫快照？"></a>Q3 对于数据中经常变化的字段，单独分离出来做一个表，是不是叫快照？</h2><blockquote>
<p><code>回答</code>：不叫快照，快照有点类似历史表，记录当时的情况。</p>
<p>比如总表有100个字段，但是其中有5个字段是经常变的，比如浏览次数，购买量等。那么这5个字段可以单独成一张表，可以提高操作效率。从5个字段的表中找5个字段，肯定比从100个字段的表中找5个字段要快</p>
</blockquote>
<h2 id="Q4-富媒体编辑器上传图片如何处理？"><a href="#Q4-富媒体编辑器上传图片如何处理？" class="headerlink" title="Q4 * 富媒体编辑器上传图片如何处理？"></a>Q4 * 富媒体编辑器上传图片如何处理？</h2><blockquote>
<p><code>回答</code>：</p>
<p>在文件上传那章会有介绍的，富文本框上传并显示图片一般会有几种方法</p>
<ol>
<li>图片直接粘贴到富文本框中，这种方法会把整个图片转成base64文本，存进数据库，数据库资源很宝贵，这种方法不适合生产使用</li>
<li><strong>单独做文件上传功能，再将上传后的图片或视频，通过链接的方式添加到富文本框中</strong></li>
<li>修改富文本框源码中的添加文件事件，即在第1种方法中间插入操作，将base64文本存到文件服务器，并得到链接后，转成第2种方法，通过链接的方式添加到富文本框中。这个方法体验好，但对程序员技术要求较高。</li>
<li><u>可以将第1种方法得到的base64存到第三方平台</u>，比如阿里云OSS，而不是数据库。优点是不限带宽，速度快，缺点是要收流量费，也不是很贵</li>
</ol>
<p>我们这次课程采用的是第2种方法，<strong>难度不高，不占数据库存储</strong>，<u>适用于大多数的程序员</u></p>
</blockquote>
<h2 id="Q：区别setInterval和setTimeout"><a href="#Q：区别setInterval和setTimeout" class="headerlink" title="Q：区别setInterval和setTimeout"></a>Q：区别setInterval和setTimeout</h2><blockquote>
<p>前者时重复的定时任务，后者只执行一次的定时任务。</p>
</blockquote>
<h2 id="7-6-一些课程代码优化"><a href="#7-6-一些课程代码优化" class="headerlink" title="7-6 一些课程代码优化"></a>7-6 一些课程代码优化</h2><h3 id="Q1-工作内容"><a href="#Q1-工作内容" class="headerlink" title="Q1 工作内容"></a>Q1 工作内容</h3><blockquote>
<p><code>描述</code>：平时工作的时候开发是干什么呀?是按照UML图实现需求吗?</p>
<p><code>回答</code>：</p>
<ul>
<li><p>uml很少有项目写，最多画个基本的<u>流程图</u>和<strong>时序图</strong>。</p>
</li>
<li><p>互联网公司一般都是紧急需求，快速迭代，有可能就说：需要做个登录功能，后面的都是开发自己做了。当然你是实习，估计就做些简单的复制粘贴。其实大多数开发就是做复制粘贴，比如已经有了个讲师管理，参照这个功能，做个学生管理。</p>
</li>
</ul>
</blockquote>
<h3 id="Q2-course一定要用LocalStorage或SessionStorage来传递吗？"><a href="#Q2-course一定要用LocalStorage或SessionStorage来传递吗？" class="headerlink" title="Q2 course一定要用LocalStorage或SessionStorage来传递吗？"></a>Q2 course一定要用LocalStorage或SessionStorage来传递吗？</h3><blockquote>
<p><code>描述</code>：</p>
<blockquote>
<ul>
<li>本节中, 在 vue 中的 course 变量一定要通过 LocalStorage 或 SessionStorage 传递吗？</li>
<li>一般在什么场合下需要用 LocalStorage 或 SessionStorage 来传递变量？</li>
<li>我自己思考的结果： <ul>
<li>各个不同的 vue 页面之间传递变量是通过 LocalStorage 或 SessionStorage 来实现的，如果需要在各个不同的 vue 页面之间传递变量，就要使用 LocalStorage 或 SessionStorage ，</li>
</ul>
</li>
</ul>
</blockquote>
<p><code>回答</code>：</p>
<blockquote>
<p>Vue项目页面章传递参数有很多种</p>
<ol>
<li><u>url里加参数传递</u>，比如：xxx?id&#x3D;123，适合<em>少量数据</em>，优点是<em>刷新页面也不会丢</em></li>
<li><strong>使用<u>vuex</u>组件</strong>，优点是全局，响应式（很大的一个优点），<u>缺点是刷新就没了</u></li>
<li>使用<strong>h5 localStorage 或 sessionStorage</strong>，<u>优点是全局</u>，<em>刷新也不会丢</em>，可存大量数据，<u>缺点是没有响应式</u></li>
</ol>
<p>一般Vue项目的全局参数可使用<strong>vuex+sessionStorage</strong>，发挥两者的优点：全局、刷新不丢。</p>
<p>简单来说，集成vuex后，页面设置和获取参数，都用vuex来操作，而vuex内部再和sessionStorage集成，所以各页面里，都不再直接操作sessionStorage。</p>
</blockquote>
</blockquote>
<h2 id="7-7-讲师管理功能开发"><a href="#7-7-讲师管理功能开发" class="headerlink" title="7-7 讲师管理功能开发"></a>7-7 讲师管理功能开发</h2><blockquote>
<p><code>前端开发小技巧</code>：可以用浏览器的开发工具修改样式，调试好后，再把样式拷到代码里。</p>
</blockquote>
<h3 id="Q1-循环依赖怎么解决？"><a href="#Q1-循环依赖怎么解决？" class="headerlink" title="Q1 循环依赖怎么解决？"></a>Q1 循环依赖怎么解决？</h3><h3 id="Q2-为啥我的课程管理页面排列时乱的"><a href="#Q2-为啥我的课程管理页面排列时乱的" class="headerlink" title="Q2 为啥我的课程管理页面排列时乱的"></a>Q2 为啥我的课程管理页面排列时乱的</h3><blockquote>
<p>是因为bootstrap自动布局，因为每一块的奥杜都不一样，有的有描诉，有的没有，<em>导致排列乱了</em></p>
<p><u>所以在开发中有个原则，<strong>约定由于配置</strong></u></p>
<p>比如<em>约定好</em> <strong>每门课程标题10个字符左右，描述100个字符左右，封面固定高度宽度，这样页面开发起来就很简单，且好看。</strong>否则前端就得写一堆的样式代码来保证前端对齐。</p>
</blockquote>
<h3 id="Q3-过滤器问题的请教？"><a href="#Q3-过滤器问题的请教？" class="headerlink" title="Q3 过滤器问题的请教？"></a>Q3 过滤器问题的请教？</h3><blockquote>
<p><code>描述</code>：</p>
<p>本节中，过滤器是这样写的，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-for=&quot;teacher in teachers.filter(t=&gt;&#123;return t.id===course.teacherId&#125;)&quot; class=&quot;profile-activity clearfix&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">	&lt;img v-show=&quot;!teacher.image&quot; class=&quot;pull-left&quot; src=&quot;/ace/assets/images/avatars/avatar5.png&quot;&gt;</span><br><span class="line">	&lt;img v-show=&quot;teacher.image&quot; class=&quot;pull-left&quot; v-bind:src=&quot;teacher.image&quot;&gt;</span><br><span class="line">	&lt;a class=&quot;user&quot; href=&quot;#&quot;&gt; &#123;&#123;teacher.name&#125;&#125; &lt;/a&gt;</span><br><span class="line">	&lt;br&gt;</span><br><span class="line">	&#123;&#123;teacher.position&#125;&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>而以前，你指导的过滤器是这样写的，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;&#123;&#123;SECTION_CHARGE | optionKV(section.charge)&#125;&#125;&lt;/td&gt;</span><br></pre></td></tr></table></figure>

<p>后者使用了 filter.js 中的 optionKV() 方法，而前者没有使用，为什么会有这种区别呢？</p>
<p>是因为显示内容的来源不一样吗？前者中，显示的内容 teacher.image, teacher.position 来源于数据库表中的记录，而要显示与section.charge对应的 “免费”，”收费”来源于enums.js</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>本质都是在一个堆数据中，找出目标数据。<u>optionKV是用的vue过滤器</u>，而<u>filter是js原生自带的数据过滤函数</u>。</p>
<p>针对<u>enums.js里的是所有对象的key</u>, value属性是固定的，所以写了个optionKV。</p>
<p>像<u>teacher这种来源于数据库表的</u>，每张表的属性字段名字可能都不一样，不太好写通用方法。</p>
</blockquote>
<h3 id="Q：-ace-admin中的多选组件不能正常使用"><a href="#Q：-ace-admin中的多选组件不能正常使用" class="headerlink" title="Q： ace admin中的多选组件不能正常使用"></a>Q： ace admin中的多选组件不能正常使用</h3><h3 id="Q4：每次启动服务器总会报503"><a href="#Q4：每次启动服务器总会报503" class="headerlink" title="Q4：每次启动服务器总会报503"></a>Q4：每次启动服务器总会报503</h3><blockquote>
<p>为什么每次启动服务后请求数据都会报503，大概过1分钟左右才会正常？</p>
</blockquote>
<blockquote>
<p><code>答</code>：路由中用了 lb:&#x2F;&#x2F;，用负载均衡的方式，会有一段时间是这样，可以改用ip的形式</p>
<p><code>答2</code>：应该和Eureka的慢注册有关，<u>Eureka为了保证CAP中的AP特性</u>  <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000016909677?utm_source=tag-newest">Eureka服务注册最长需要2分钟的原因</a></p>
</blockquote>
<h2 id="7-8-分类管理如何改成用无限级树的方式"><a href="#7-8-分类管理如何改成用无限级树的方式" class="headerlink" title="7-8 分类管理如何改成用无限级树的方式"></a>7-8 分类管理如何改成用无限级树的方式</h2><blockquote>
<p><code>描述</code>：<br>课程只有两级分类，能否改成无限级分类，无限级树的增删改查如何做<br><strong>难度：</strong><br>✩✩✩✩<br><strong>思路点拨：</strong><br>无限级树的表结构可以和现有的分类表结构一致</p>
<ul>
<li>增：需要区分增加顶级分类和子分类</li>
<li>删：删除某一分类时，需要把其所有子子孙孙分类全部删除</li>
<li>改：可以只改分类名称，也可以加大难度，支持修改父分类</li>
<li>查：使用树形控件，将所有分类显示出来</li>
</ul>
</blockquote>
<blockquote>
<p><code>回答一</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 递归树，一个函数即可</span></span><br><span class="line"><span class="title function_">recursionTree</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> treeArray = [];</span><br><span class="line">    <span class="keyword">let</span> array = [...arr];</span><br><span class="line">    <span class="keyword">let</span> roots = array.<span class="title function_">filter</span>(<span class="function"><span class="params">element</span> =&gt;</span> element.<span class="property">parent</span> ==<span class="string">&#x27;00000000&#x27;</span>);</span><br><span class="line">    treeArray,<span class="title function_">push</span>(...roots);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">seetChildren</span> = (<span class="params">result,data</span>) =&gt; &#123;</span><br><span class="line">        resout.<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">            element.<span class="property">children</span> = data.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">parent</span> == element.<span class="property">id</span>);</span><br><span class="line">            <span class="keyword">if</span> (element.<span class="property">children</span>.<span class="property">length</span> &gt;<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="title function_">setChildren</span>(element.<span class="property">children</span>,data);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                element.<span class="property">children</span> = <span class="literal">undefined</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setChildren</span>(treeArray,array);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = treeArray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</blockquote>
<h1 id="第8章"><a href="#第8章" class="headerlink" title="第8章"></a>第8章</h1><hr>
<h2 id="8-1-基本的文件上传"><a href="#8-1-基本的文件上传" class="headerlink" title="8-1 基本的文件上传"></a>8-1 基本的文件上传</h2><blockquote>
<p>换个思路：使用netty把文件上传至cento云服务器中</p>
</blockquote>
<h3 id="Q1：为什么ResponseDto这种泛型类都不指定具体类型"><a href="#Q1：为什么ResponseDto这种泛型类都不指定具体类型" class="headerlink" title="Q1：为什么ResponseDto这种泛型类都不指定具体类型"></a>Q1：为什么ResponseDto这种泛型类都不指定具体类型</h3><blockquote>
<p><code>回答</code>：因为不同的接口返回的类型不一样，所以用泛型，<em>即泛型的应用场景</em></p>
</blockquote>
<h3 id="Q2：为啥上传图片用formData，不用之前惯用的json呢？"><a href="#Q2：为啥上传图片用formData，不用之前惯用的json呢？" class="headerlink" title="Q2：为啥上传图片用formData，不用之前惯用的json呢？"></a>Q2：为啥上传图片用formData，不用之前惯用的json呢？</h3><blockquote>
<p><code>描述</code>：难道因为这样方便后台框架直接用MultipartFile解析吗？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：将图片作Base64处理，变成字符串，再用惯用的json上传。</p>
</blockquote>
<h3 id="Q3：id主键值的探讨"><a href="#Q3：id主键值的探讨" class="headerlink" title="Q3：id主键值的探讨"></a>Q3：id主键值的探讨</h3><blockquote>
<p><code>描述</code>：现在的id主键值，字符串类型，排序不是按添加事件顺序排序，而且索引查询效率也没有自增int高吧。如何改进</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>自增ID在<strong>分表分库</strong>的场景中就用不了了。可以用雪花算法。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/cloudyan/snowflake">https://github.com/cloudyan/snowflake</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040964518">讲讲雪花算法</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/772913">雪花算法-阿里云社区</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/blogs/344958">雪花算法详解与实现-华为云社区</a></p>
</blockquote>
<h2 id="8-2-关于非图像的显示"><a href="#8-2-关于非图像的显示" class="headerlink" title="8-2 关于非图像的显示"></a>8-2 关于非图像的显示</h2><blockquote>
<p><code>描述</code>：</p>
<p>请教一个问题，本节中，对于头像这种图片文件，在 teacher.vue中，上传头像图片成功后，代码是这样实现显示的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-show=&quot;teacher.image&quot; class=&quot;row&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;col-md-4&quot;&gt;</span><br><span class="line">    &lt;img v-bind:src=&quot;teacher.image&quot; class=&quot;img-responsive&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>请问老师，如果上传的是像 <code>.bin</code> 这种不能够显示的文件，<u>上述的代码要怎么写才可以实现通知用户上传成功</u>(<strong>交互的技巧</strong>)呢？（我google过了，真的找不到相关的资料，像，等多媒体标签都不合适）</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>应该在图片上传的时候，校验只允许上传指定后缀的文件。课程有介绍的，你可能还没看到<br><img src="https://img1.sycdn.imooc.com/szimg/604b534409e58a8c05000220.jpg" alt="//img1.sycdn.imooc.com/szimg/604b53440971b63114600642.jpg"></p>
<blockquote>
<p><code>提问者的追问</code>：</p>
<p>老师，我看了，我已经是第二次重新学习这门课程了。第一次我手动一行行敲代码，都敲了两个多月。 我知道你是做了 后缀名的拦截，v-bind:suffixs&#x3D;”[‘jpg’, ‘jpeg’, ‘png’]”，这些什么的我都知道，因为我的需求是上传 .bin文件，所以，我已经改为了 v-bind:suffixs&#x3D;”[‘bin’]”, 现在我的需求麻烦看一下上述回复中的截图，谢谢老师！</p>
</blockquote>
</blockquote>
<h2 id="8-3-4-文件上传组件开发"><a href="#8-3-4-文件上传组件开发" class="headerlink" title="8-3,4 文件上传组件开发"></a>8-3,4 文件上传组件开发</h2><h3 id="Q1：关于如果纠正为input-id的一些小bug"><a href="#Q1：关于如果纠正为input-id的一些小bug" class="headerlink" title="Q1：关于如果纠正为input-id的一些小bug"></a>Q1：关于如果纠正为input-id的一些小bug</h3><blockquote>
<p><code>描述</code>：</p>
<p><img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220809190718076.png" alt="image-20220809190718076"></p>
<p>今天看到这里，视频这里说纠正一下应该用input-id，但是这里改成input-id之后点击按钮就没反应了。经过debug，发现问题在于组件调用selectFile（）方法时里面的id也应改为<code>$(&quot;#&quot; + _this.inputId + “-input”).trigger(“click”);</code>才能同步获取id修改。</p>
<p>还有记得顶一下_this</p>
</blockquote>
<blockquote>
<p><code>回答</code>：对的，组件里对文件的操作，都应该用inputId，下面是最终代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selectFile () &#123;</span><br><span class="line">    <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    $(<span class="string">&quot;#&quot;</span> + _this.<span class="property">inputId</span> + <span class="string">&quot;-input&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Q2：请教一个登录问题"><a href="#Q2：请教一个登录问题" class="headerlink" title="Q2：请教一个登录问题"></a>Q2：请教一个登录问题</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师，我是服务端的初学者，登录问题我一直存在着困惑。</p>
<ul>
<li>有一些网站用户登录一次后，可以有一段时间不用自动登录(比如慕课网)。</li>
<li>有的网站登录一次后就不用重复登录。<ul>
<li>老师可以给出这两种方式的前后端处理流程吗？</li>
<li>我在自己的小Demo中发现，即使我没有设置Cookie的时间，每次关闭网页就要重新登陆。<br>希望老师解答一下。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p><code>回答1</code>：	</p>
<p>一般是将登录信息存储到h5的localStorage，关闭浏览器后下次重新打开还能读到，包括用户信息，登录的token。</p>
<p>比如7天内不用重新登录，那后端可以对token的时效做个校验，超过7天就不能再用了，需重新登录。</p>
<p>关于登录token的用法，在后面章节有介绍</p>
<hr>
<p><code>回答2</code>：</p>
<p><u>最原始的方法</u>是<strong>只使用cookie</strong>,现在都是<u><strong>cookie和session搭配用</strong></u>,</p>
<ul>
<li><em>用户端在向服务器发送请求时,服务端会给用户端发送一个cookie</em>,用来记录该用户的状态(因为<u>http协议是无状态的</u>),.而<strong>搭配使用</strong>就是<u>在cookie里面存入sessionId</u>.在下一次请求的时候,就会带着cookie(已经存入服务端发送的sessionId)来请求服务端.也有搭配redis用的,因为session在服务器重启之后就没了.</li>
</ul>
<p> <strong>cookie是保存在浏览器的,session是保存在服务器内存里</strong>,如果<u>只用cookie也能实现会话跟踪</u>.</p>
<ul>
<li>你在登录的时候,打开浏览器控制台,application -&gt; cookie 里面就存有你的登录信息,如果清除掉,在刷新页面,登录信息就会失效了.而登出这个功能就是这样的,清除浏览器端的用户cookie.</li>
</ul>
</blockquote>
<h2 id="8-5-6-增加文件管理菜单"><a href="#8-5-6-增加文件管理菜单" class="headerlink" title="8-5,6  增加文件管理菜单"></a>8-5,6  增加文件管理菜单</h2><h3 id="Q1：上传文件的问题"><a href="#Q1：上传文件的问题" class="headerlink" title="Q1：上传文件的问题"></a>Q1：上传文件的问题</h3><blockquote>
<p><code>描述</code>：如果用户更换了头像，硬盘上的头像，还有图片url数据库记录，删除好还是保留好？</p>
<p><code>回答</code>：在后面我有介绍极速秒传功能，</p>
<p><u>极速妙传</u>要求上传过的<strong>原始文件、数据库记录</strong>都不能删除。</p>
<p>如果你的系统是一些网盘类的，经常出现重复的，比如上传电影，音乐等，可以用保留的方案。</p>
<p>如果你的系统<strong>用不到极速秒传</strong>，或者是<strong>每次上传肯定都不一样</strong>，可以用<u>删除的方案</u>。</p>
<p><em>头像这种一般不会很大</em>，而且重复比较小，<strong>可以用删除的方案</strong></p>
</blockquote>
<h3 id="Q2-参数传递问题"><a href="#Q2-参数传递问题" class="headerlink" title="Q2:参数传递问题"></a>Q2:参数传递问题</h3><blockquote>
<p><code>描述</code>：</p>
<p><code>public ResponseDto uploadFile（@RequestParam MultipartFile file,String use）</code></p>
<p>上述代码中<u>use参数</u>也是通过表单方式传递过来的，为什么<strong>不用加</strong><u>RequestParam注解</u>？</p>
<p><code>回答</code>：</p>
<p>不需要也能接收到，SpringBoot有很多参数相关的注解，比如你说的RequestParam，还有RequestBody，PathVariable等，前端的写法不一样，后端用的注解就不一样</p>
</blockquote>
<h2 id="8-7-spring-cloud"><a href="#8-7-spring-cloud" class="headerlink" title="8-7 spring cloud"></a>8-7 spring cloud</h2><h3 id="Q1-1"><a href="#Q1-1" class="headerlink" title="Q1:"></a>Q1:</h3><blockquote>
<p><code>描述</code>：为什么使用spring cloud框架，但是除了eureka，没有使用其他Spring Cloud核心组件？比如<code>Hystrix</code> <code>Zuul</code>之类的</p>
<p><u>主要是看简历模板，时殷弘spring cloud有对应的技能树，这样面试时向别人介绍项目，面试官会质疑类似的问题</u></p>
<p><code>回答</code>：</p>
<ul>
<li>项目中没用到限流降级，所以没讲到Hystrix</li>
<li>Zuul已经被Spring抛弃了，主推课程中用到的Gateway</li>
<li>至于注册中心，后面会更换Nacos</li>
</ul>
</blockquote>
<h3 id="Q2：文件服务器问题"><a href="#Q2：文件服务器问题" class="headerlink" title="Q2：文件服务器问题"></a>Q2：文件服务器问题</h3><blockquote>
<p> <code>描述</code>：</p>
<ul>
<li>公司要弄个视频网站，要求用自己的机房的私有服务器，不允许用oss，请问是像课程那样springboot暴露个静态目录呢？还是要弄个ftp的服务器作为文件服务器？还是有更好的解决方案？</li>
</ul>
<p><code>回答</code>：</p>
<p>如果是简单的视频网站，用我课程里的就可以了。如果是准备做大的，一般会配置多个节点，这时文件就会分散到各个节点上，不便管理。可以加个NFS服务器，就是把文件集中存储到NFS服务器，类似windows的共享文件夹。可以百度下NFS文件服务器	</p>
</blockquote>
<h3 id="F：关于vue的断点调试"><a href="#F：关于vue的断点调试" class="headerlink" title="F：关于vue的断点调试"></a>F：关于vue的断点调试</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师，可否发一个有关vue的调试链接，你亲测有效的，我上网搜了好多，感觉都不靠谱，而其中讲到在idea中调试vue的又是少之又少，谢谢老师！</p>
<p><code>回答</code>：</p>
<p>有一种简单的办法，在要打断点的地方，加一行代码：debugger，用chrome测试走到这里时就会进入断点调试</p>
<p><img src="https://img1.sycdn.imooc.com/szimg/5f2bf7d109e9103c05000245.jpg" alt="https://img1.sycdn.imooc.com/szimg/5f2bf7d10979094f06430314.jpg"></p>
</blockquote>
<h3 id="Q3-video动态绑定src未触发vue的渲染"><a href="#Q3-video动态绑定src未触发vue的渲染" class="headerlink" title="Q3:video动态绑定src未触发vue的渲染"></a>Q3:video动态绑定src未触发vue的渲染</h3><blockquote>
<p>1.问题</p>
<p>视频上传成功后，对<code>section.video</code>赋值，未触发视频标签的显示，需要手动更改一下其他的表单值，视频才会刷新出来。但看老师的视频，只要上传成功，为<code>section.video</code>赋值后，视频是立即自动加载出来的。不知这属于什么情况，该怎样处理呢？</p>
<h3 id="动图演示"><a href="#动图演示" class="headerlink" title="动图演示"></a>动图演示</h3><p><img src="https://img.mukewang.com/szimg/5eb3cc2b0a2597e215400730.jpg" alt="动图演示"></p>
<h3 id="静图说明"><a href="#静图说明" class="headerlink" title="静图说明"></a>静图说明</h3><p>与动图不是同一次上传截取，打印出来的地址不同，仅用作说明<br><img src="https://img.mukewang.com/szimg/5eb3ccc109cc03e213040251.jpg" alt="图片描述"><br><img src="https://img.mukewang.com/szimg/5eb3ccd7090e2a7211480226.jpg" alt="图片描述"></p>
</blockquote>
<blockquote>
<p><code>回答</code>：值有了，但是没有渲染到界面上。</p>
<p>这个问题常见于前端框架+jquery插件一起使用时。比如vue或angular框架中使用了jquery日期插件或树型插件或其它插件，就会出现这种赋值了，但是界面没体现出来。不排除有其它原因也会出现这种情况。</p>
<p>可以用这个方法解决：把这句_this.section.video&#x3D;video换成_this.$set(_this.section, ‘video’, video)</p>
</blockquote>
<h2 id="8-8-课程内容添加文件管理"><a href="#8-8-课程内容添加文件管理" class="headerlink" title="8-8 课程内容添加文件管理"></a>8-8 课程内容添加文件管理</h2><h3 id="F-git里关于HEAD和MASETER-的注意事项"><a href="#F-git里关于HEAD和MASETER-的注意事项" class="headerlink" title="F:git里关于HEAD和MASETER 的注意事项"></a>F:git里关于HEAD和MASETER 的注意事项</h3><blockquote>
<p>HEAD是表示本地代码所在的位置。</p>
<p>jquery选择器，<u>不管是id还是css</u>，<strong>都是按数组的方式来获取选择出来的元素</strong></p>
</blockquote>
<h3 id="Q1-前端如何更准确定位错误"><a href="#Q1-前端如何更准确定位错误" class="headerlink" title="Q1:前端如何更准确定位错误"></a>Q1:前端如何更准确定位错误</h3><blockquote>
<p><code>回答</code>：</p>
<p>前端常用的是<u>打日志</u>，在一些<strong>重要步骤</strong>上打日志，看日志输出到哪一步结束了，这样来定位。</p>
<p>如果会用浏览器debug也可以。我记得有一门免费课是专门讲前端调试的，可以搜看看</p>
</blockquote>
<ul>
<li>数据传输是经常出问题的地方，有时候输入某个值没了，有时候输出结果漏了某个值。可以把输入输出参数打出来，我课程中也有，使用统一过滤器来打日志</li>
</ul>
<h3 id="Q2-关于course-content-file表结构的设计"><a href="#Q2-关于course-content-file表结构的设计" class="headerlink" title="Q2:关于course_content_file表结构的设计"></a>Q2:关于course_content_file表结构的设计</h3><blockquote>
<p><code>描述</code>：</p>
<ul>
<li>我讨论的重点不是表名的更改，而是表结构，即</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table course_content_file (</span><br><span class="line">	id char(8) not null default ‘’ comment ‘id’,</span><br><span class="line">	course_id char(8) not null comment ‘课程id’,</span><br><span class="line">	url varchar(100) comment ‘地址’,</span><br><span class="line">	name varchar(100) comment ‘文件名’,</span><br><span class="line">	size int comment ‘大小|字节b’,</span><br><span class="line">	primary key (id)</span><br><span class="line">) engine=innodb default charset=utf8mb4 comment=‘课程内容文件’;</span><br></pre></td></tr></table></figure>

<ul>
<li>改为</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table course_file (</span><br><span class="line">	id char(8) not null default ‘’ comment ‘id’,</span><br><span class="line">	course_id char(8) comment ‘课程id|course.id’,</span><br><span class="line">	file_id char(8) comment ‘文件id|file.id’,</span><br><span class="line">	primary key (id)</span><br><span class="line">) engine=innodb default charset=utf8mb4 comment=‘课程文件’;</span><br></pre></td></tr></table></figure>

<hr>
<p><code>回答</code>：</p>
<ul>
<li>在后面的课程中，会向file表中新增(<code>shard_index</code> int comment ‘已上传分片’); (<code>shard_size</code> int comment ‘分片大小|B’); (<code>shard_total</code> int comment ‘分片总数’); (<code>key</code> varchar(32) comment ‘文件标识’); 这些与分片相关的字段，这些字段没必要在课程内容页面中显示，所以，将几个必要的字段冗余成一张course_content_file表</li>
<li>你是想直接和file表关联起来？这样也是可以的，没问题。我是考虑要在内容页面显示文件信息，且不需要分片相关的字段，所以将几个必要的字段冗余成一张course_content_file表。</li>
</ul>
</blockquote>
<h3 id="Q3：课程内容里用的summernote富文本编辑器，可以用哪个Markdown编辑器放前端"><a href="#Q3：课程内容里用的summernote富文本编辑器，可以用哪个Markdown编辑器放前端" class="headerlink" title="Q3：课程内容里用的summernote富文本编辑器，可以用哪个Markdown编辑器放前端"></a>Q3：课程内容里用的summernote富文本编辑器，可以用哪个Markdown编辑器放前端</h3><blockquote>
<p><code>描述</code>：</p>
<p>课程内容里用的summernote富文本编辑器，可以用哪个Markdown编辑器放前端。<br>1、想要CSDN里那种Markdown编辑器，可以实现复制图片后直接粘贴，不需要点插入按钮。</p>
<p>2、富文本编辑器可以</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#content&quot;</span>).<span class="title function_">summernote</span>(&#123;</span><br><span class="line">    <span class="attr">focus</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">callbacks</span>: &#123;</span><br><span class="line">  <span class="comment">/* 图片上传回调方法,解决summernote编辑器默认上传图片保存的是base64的问题,修改后的效果等同于：</span></span><br><span class="line"><span class="comment">   在课程内容页面上传图片后，点击summernote编辑器的插入图片按钮，输入前面上传图片展现的url，点确认，图片会显示在编辑器内。</span></span><br><span class="line"><span class="comment">      即：uploadSummerNotePic()方法做了以下操作：</span></span><br><span class="line"><span class="comment">      1、上传图片到阿里云oss（简单上传，没有分片上传。有限制文件格式为[&#x27;jpg&#x27;, &#x27;jpeg&#x27;, &#x27;png&#x27;]，</span></span><br><span class="line"><span class="comment">      2、把文件记录通过afterUploadContentFile()方法保存到`course_content_file`表中，（1、2两步等同于&lt;file&gt;组件做的操作，代码也一样的）</span></span><br><span class="line"><span class="comment">      3、调用summernote编辑器的函数把url对应的图片显示在编辑器中。 */</span></span><br><span class="line">        <span class="attr">onImageUpload</span>: <span class="keyword">function</span>(<span class="params">files, editor, welEditable</span>) &#123;</span><br><span class="line">            _this.<span class="title function_">uploadSummerNotePic</span>(files[<span class="number">0</span>], editor, welEditable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>和</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">uploadSummerNotePic(file, editor, welEditable) &#123;</span><br><span class="line">  let _this = this;</span><br><span class="line"></span><br><span class="line">  // 判断文件格式</span><br><span class="line">  let suffixs =[&#x27;jpg&#x27;, &#x27;jpeg&#x27;, &#x27;png&#x27;];</span><br><span class="line">  let fileName = file.name;</span><br><span class="line">  let suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;) + 1, fileName.length).toLowerCase();</span><br><span class="line">  let validateSuffix = false;</span><br><span class="line">  for (let i = 0; i &lt; suffixs.length; i++) &#123;</span><br><span class="line">    if (suffixs[i].toLowerCase() === suffix) &#123;</span><br><span class="line">      validateSuffix = true;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (!validateSuffix) &#123;</span><br><span class="line">    Toast.warning(&quot;文件格式不正确！只支持上传：&quot; + suffixs.join(&quot;,&quot;));</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let formData = new window.FormData();</span><br><span class="line">  formData.append(&#x27;file&#x27;, file);</span><br><span class="line">  formData.append(&quot;use&quot;, this.FILE_USE.COURSE.key);</span><br><span class="line">  Loading.show();</span><br><span class="line">  _this.$ajax.post(process.env.VUE_APP_SERVER + &#x27;/file/admin/oss-simple&#x27;, formData).then((response)=&gt;&#123;</span><br><span class="line">    Loading.hide();</span><br><span class="line">    let resp = response.data;</span><br><span class="line">    console.log(&quot;上传文件成功：&quot;, resp);</span><br><span class="line">    console.log(&#x27;图片路径：&#x27; + resp.content.path)</span><br><span class="line">    $(&#x27;#content&#x27;).summernote(&#x27;insertImage&#x27;, resp.content.path, &#x27;插入图片&#x27;);</span><br><span class="line">    _this.afterUploadContentFile(resp);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>实现点击按钮上传图片到阿里云并显示在编辑器，那有办法点击按钮上传视频到阿里云并显示在编辑器 吗？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
</blockquote>
<h1 id="第9章"><a href="#第9章" class="headerlink" title="第9章"></a>第9章</h1><h2 id="Q1-分片上传时前台控制？"><a href="#Q1-分片上传时前台控制？" class="headerlink" title="Q1 分片上传时前台控制？"></a>Q1 分片上传时前台控制？</h2><blockquote>
<p>使得，<strong>在前台负责九三分片，并将各分片数据依次传给后端。</strong></p>
</blockquote>
<h2 id="9-2-3-分片上传功能"><a href="#9-2-3-分片上传功能" class="headerlink" title="9.2,3-分片上传功能"></a>9.2,3-分片上传功能</h2><h3 id="Q1：关于文件上传的问题"><a href="#Q1：关于文件上传的问题" class="headerlink" title="Q1：关于文件上传的问题"></a>Q1：关于文件上传的问题</h3><blockquote>
<p><code>描述</code>：很多网站都是批量上传的，该如何实现？</p>
<p><code>回答</code>：h5有个multiple属性，可以一次选择多个文件，可以试试</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">typer</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;img&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;multiple&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​			跟服务端的交互，可以考虑一个文件一个文件的调用上传接口，也可扩展下接口，弄个文件数组参数。</p>
</blockquote>
<h3 id="Q2-分片上传的适用性"><a href="#Q2-分片上传的适用性" class="headerlink" title="Q2 分片上传的适用性"></a>Q2 分片上传的适用性</h3><blockquote>
<p>本地上传的分片上传与阿里云的不冲突。</p>
</blockquote>
<h3 id="Q3-上传文件问题"><a href="#Q3-上传文件问题" class="headerlink" title="Q3:上传文件问题"></a>Q3:上传文件问题</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师您好，在9.2视频末尾的代码我觉得有一些问题，在上传大视频时，每次上传成功后数据库file表字段所生成的key值都是相同的，当我上传一个视频后，再上传一个新的视频时该视频的key值与之前的key值是一样的。</p>
<p><img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220818180907124.png" alt="image-20220818180907124"></p>
<p>经过我多次测试，发现都是这个值6sfSqfOwzmik4A4icMYuUe，而且我发现其他同学提问题的截图中所生成的key也是这个值。这个问题是我跟视频做到9.5时才发现，我不断回溯代码后才发现问题出在这，实在不知道是什么原因导致的，麻烦老师看一下这部分代码，谢谢老师！！！</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<blockquote>
<p>这个问题我在后面有讲到，<u>不能直接用file对象生成key</u>，应该用file里面的属性来生成</p>
</blockquote>
</blockquote>
<h3 id="Q4：我自做聪明的问题"><a href="#Q4：我自做聪明的问题" class="headerlink" title="Q4：我自做聪明的问题"></a>Q4：我自做聪明的问题</h3><blockquote>
<p><code>描述</code>：</p>
<ul>
<li>一、<img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220819104952591.png" alt="image-20220819104952591"></li>
<li>二、<img src="/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/image-20220819105000244.png" alt="image-20220819105000244"></li>
</ul>
<p>为什么不能通过id是否为空 来决定时insert还是upadate，而是要对fileDb对象进行判空。</p>
<p><code>自答</code>：自作聪明了，前端传过来的的参数是<code>suffix</code>,<code>size</code>,<code>use</code>,<code>shard_at</code>,<code>shardTotal</code>,<code>key</code>以及<code>shard</code>，就是没有<code>id</code></p>
</blockquote>
<h3 id="Q5：上传不同视频生成的md5值是相同的"><a href="#Q5：上传不同视频生成的md5值是相同的" class="headerlink" title="Q5：上传不同视频生成的md5值是相同的"></a>Q5：上传不同视频生成的md5值是相同的</h3><blockquote>
<p><code>描述</code>：老师您好，生成md5用的是md5.js这个工具，但是上传不同的视频后，生成的md5一直是相同的，辛苦老师帮忙看下是哪里有问题呢<br><img src="https://img.mukewang.com/szimg/5fcfab4709b7266000000000.jpg" alt="图片描述"><br><img src="https://img.mukewang.com/szimg/5fcfab55095fc6dd07900696.jpg" alt="图片描述"></p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>​	file对象不能转json，所以生成出来的都一样，后面会有解决</p>
</blockquote>
<h3 id="Q6：频繁大文件上传会不会触发jvm的垃圾回收"><a href="#Q6：频繁大文件上传会不会触发jvm的垃圾回收" class="headerlink" title="Q6：频繁大文件上传会不会触发jvm的垃圾回收"></a>Q6：频繁大文件上传会不会触发jvm的垃圾回收</h3><blockquote>
<p><code>描述</code></p>
<p>文件读取之后存储在内存中 如果高并发的情况下感觉会很占jvm的堆区 如此一来应该会很频繁的触发jvm的垃圾回收机制 请问老师 有何优化方法啊？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>这里应该有一个BUG，把io流的关闭放到循环里，每次都关闭，就不需要垃圾回收了</p>
<p><img src="https://img.mukewang.com/szimg/5f0953d1094ad1ba05000307.jpg" alt="https://img.mukewang.com/szimg/5f0953d1099bf8e611920730.jpg"></p>
</blockquote>
<h2 id="9-4-分片合并功能开发"><a href="#9-4-分片合并功能开发" class="headerlink" title="9-4 分片合并功能开发"></a>9-4 分片合并功能开发</h2><h3 id="Q1：删除分片是程序调用System-gc"><a href="#Q1：删除分片是程序调用System-gc" class="headerlink" title="Q1：删除分片是程序调用System.gc()"></a>Q1：删除分片是程序调用System.gc()</h3><blockquote>
<p><code>描述</code>：</p>
<p>删除分片的时候程序中调用system.gc 方法。该方法不是只是会通知垃圾回收器可以进行一次垃圾回收吗。并不能保证一定会执行垃圾回收吧。如果没有执行，是不是删除分片还是会失败 	</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>system.gc()确实并不会立即进行垃圾回收，但会更快的触发垃圾回收。在实际使用中，调用system.gc()比不调用会有效果，课程中也演示了，system.gc()后，稍加一点延时，没用的对象确实被回收了。</p>
</blockquote>
<h3 id="Q2：集群环境下如何做分片的合并？"><a href="#Q2：集群环境下如何做分片的合并？" class="headerlink" title="Q2：集群环境下如何做分片的合并？"></a>Q2：集群环境下如何做分片的合并？</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师你好，看到文件分片上传这里有一个问题， <strong>如果后台是集群环境</strong>，<u>每一个分片可能是被上传到了不同的节点上</u>， 这时候该如何合并文件？<br><em>是要每次都要把每个分片都上传到oss 这样的文件服务器上吗</em>？然<em>后最后统一下载下来合并</em>？</p>
</blockquote>
<blockquote>
<p><code>回答</code></p>
<p>多节点的时候，可以<strong>配置负载均衡策略</strong>为<strong>IP HASH</strong>，<u>同一个IP调上传接口时，都会路由到同一台节点</u>。<em>合并后再传到一个共享文件服务器</em>。</p>
<p>一般建议就用OSS，省去大量的运维工作</p>
<blockquote>
<p>多节点 -》 多台服务器？？？</p>
</blockquote>
</blockquote>
<h2 id="9-5-分片检查与极速秒传"><a href="#9-5-分片检查与极速秒传" class="headerlink" title="9-5 分片检查与极速秒传"></a>9-5 分片检查与极速秒传</h2><h3 id="Q1-2"><a href="#Q1-2" class="headerlink" title="Q1"></a>Q1</h3><blockquote>
<p><code>描述</code>：</p>
<p>上传完视频点击播放，如果不点暂停就关闭模态框。视频的声音还在播放，这个bug怎么解决？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：可以在modal的关闭事件里，调用aliplayer的暂时播放的方法</p>
</blockquote>
<h3 id="Q2：let-this-x3D-this"><a href="#Q2：let-this-x3D-this" class="headerlink" title="Q2：let _this &#x3D; this;"></a>Q2：let _this &#x3D; this;</h3><blockquote>
<p><code>描述</code>：RT,请问老师，这样写的原因是这个吗？<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/lipei1220/article/details/39339557">js中var self &#x3D; this的解释</a>,<br>我看到vue官网上说：“<code>this</code> 在方法里指向当前 Vue 实例”，这个vue中的this，与上述链接中说到的js中的this——“this指向的是调用执行环境的那个对象”，是否是一个意思？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>差不多是一个意思，正常我们要获取vue变量或方法的时候，就使用this，但是在一些用到回调函数的时候，this指的就不是vue变量，而是回调函数本身，所以在一开始的时候，先定义_this&#x3D;this，这样在任何位置都可以用_this来获取vue变量或方法</p>
</blockquote>
<h3 id="Q3：zIndex？"><a href="#Q3：zIndex？" class="headerlink" title="Q3：zIndex？"></a>Q3：zIndex？</h3><blockquote>
<p>老师，请教2个问题，</p>
<ol>
<li>loading.js中，</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">css: &#123;</span><br><span class="line">        zIndex: &quot;10011&quot;,</span><br><span class="line">        padding: &quot;10px&quot;,</span><br><span class="line">        left: &quot;50%&quot;,</span><br><span class="line">        width: &quot;80px&quot;,</span><br><span class="line">        marginLeft: &quot;-40px&quot;,</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>可以解释一下zIndex吗？我查到的都是z-index的，难道这里写成zIndex,marginLeft,也是同样的原因。引用你的原话，</p>
<blockquote>
<p>vue支持多少写法，驼峰式的，横线连接的，都是支持的。<br>比如官网的BaseButton，你写成&lt;base-button也是可以的。</p>
</blockquote>
<p>这个规则仅适用于HTML标签和CSS属性吗？除此之外，还有其它的适用场合吗？</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index%EF%BC%8C">https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index，</a><br>我查到的写法都是</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">z-index: 数值型，</span><br></pre></td></tr></table></figure>

<p>为何老师你的写法是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zIndex: 字符串</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>既不是vue的，也不是css原生的，这个zIndex是blockUI插件爆露出来的配置项</p>
<p>这个值设置很大，确实是因为要大于modal的z-index，要看modal的值，可以在页面打开modal时，右键，检查，可以看到modal相关的css，找到z-index</p>
</blockquote>
<h3 id="Q4：console-log-JSON-stringify-file"><a href="#Q4：console-log-JSON-stringify-file" class="headerlink" title="Q4：console.log(JSON.stringify(file));"></a>Q4：console.log(JSON.stringify(file));</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师，为什么</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(JSON.stringify(file));</span><br></pre></td></tr></table></figure>

<p>输出是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>,而</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> session = &#123;</span><br><span class="line">    <span class="string">&#x27;screens&#x27;</span> : [],</span><br><span class="line">    <span class="string">&#x27;state&#x27;</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&quot;abc&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(session));</span><br></pre></td></tr></table></figure>

<p>却输出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&#123;&quot;</span>screens<span class="string">&quot;:[],&quot;</span>state<span class="string">&quot;:true,&quot;</span>name<span class="string">&quot;:&quot;</span>abc<span class="string">&quot;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>上述的 file 和 session 不都是属于object类型吗？为何file不会输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name: &quot;test.mp4&quot;</span><br><span class="line">lastModified: 1901173357457</span><br><span class="line">lastModifiedDate: Tue May 27 2099 14:49:17 GMT+0800 (中国标准时间) &#123;&#125;</span><br><span class="line">webkitRelativePath: &quot;&quot;</span><br><span class="line">size: 37415970</span><br><span class="line">type: &quot;video/mp4&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>可以看下这篇：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/24139216/js-input-file-to-json-with-for-example-json-stringify">https://stackoverflow.com/questions/24139216/js-input-file-to-json-with-for-example-json-stringify</a></p>
<p>意思大概是这个方法在chrome firefox safari对file类型数据不起作用，解决方法跟我们课程一样，取出file里的几个字段，放到object里，再stringify</p>
<p><img src="https://img.mukewang.com/szimg/5f3e7c3f0915a1d205000299.jpg" alt="https://img.mukewang.com/szimg/5f3e7c3e09af851610530628.jpg"></p>
</blockquote>
<h3 id="Q5：断点上传问题"><a href="#Q5：断点上传问题" class="headerlink" title="Q5：断点上传问题"></a>Q5：断点上传问题</h3><blockquote>
<p><code>描述</code>：</p>
<p>代码中用的new file(fileName,true)这种方式生成分片，如果在生成分片时中断了，下次代码再走到这儿，这个分片文件应该会出现异常</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>代码中用的new file(fileName,true)这种方式生成分片，如果在生成分片时中断了，下次代码再走到这儿，这个分片文件应该会出现异常</p>
</blockquote>
<h3 id="Q6：文件标识key？"><a href="#Q6：文件标识key？" class="headerlink" title="Q6：文件标识key？"></a>Q6：文件标识key？</h3><blockquote>
<p><code>描述</code>：</p>
<blockquote>
<p>本节中，你把</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let key = hex_md5(file); </span><br></pre></td></tr></table></figure>

<p>改为了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let key = hex_md5(file.name + file.size + file.type); </span><br></pre></td></tr></table></figure>

<p>为此，我提出一点疑问？<br>如果同一文件更改了文件名后再次上传，那按照上述代码的逻辑，那key会不同样，从而不会触发极速秒传。对吧？<br>为此，我把upload()改写成这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">uploadFile () &#123;</span><br><span class="line">        let _this = this;</span><br><span class="line">        let formData = new window.FormData();</span><br><span class="line">        let file = _this.$refs.file.files[0]; </span><br><span class="line"></span><br><span class="line">        console.log(JSON.stringify(file));</span><br><span class="line">        /*</span><br><span class="line">          name: &quot;test.mp4&quot;</span><br><span class="line">          lastModified: 1901173357457</span><br><span class="line">          lastModifiedDate: Tue May 27 2099 14:49:17 GMT+0800 (中国标准时间) &#123;&#125;</span><br><span class="line">          webkitRelativePath: &quot;&quot;</span><br><span class="line">          size: 37415970</span><br><span class="line">          type: &quot;video/mp4&quot;</span><br><span class="line">        */</span><br><span class="line">        </span><br><span class="line">        let fileReader = new FileReader();</span><br><span class="line">        let key10 = &#123;&#125;; // 16进制转换为10进制的数值类型</span><br><span class="line">        let key62 = &#123;&#125;;</span><br><span class="line">        // 生成文件标识，标识多次上传的是不是同一个文件</span><br><span class="line">        fileReader.onload = function (e) &#123;</span><br><span class="line">          let base64 = e.target.result; </span><br><span class="line">          let key = hex_md5(base64); </span><br><span class="line">          key10 = parseInt(key, 16);</span><br><span class="line">          key62 = Tool._10to62(key10);</span><br><span class="line">          console.log(key, key10, key62);</span><br><span class="line">          console.log(hex_md5(Array()));</span><br><span class="line">        &#125;</span><br><span class="line">        fileReader.readAsDataURL(file);</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">          d41d8cd98f00b204e9800998ecf8427e</span><br><span class="line">          2.8194976848941264e+38</span><br><span class="line">          6sfSqfOwzmik4A4icMYuUe</span><br><span class="line">         */</span><br><span class="line"></span><br><span class="line">        // 判断文件格式</span><br><span class="line">        let suffixs = _this.suffixs;</span><br><span class="line">        let fileName = file.name;</span><br><span class="line">        let suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;) + 1, fileName.length).toLowerCase(); // substring javascript语法</span><br><span class="line">        let validateSuffix = false;</span><br><span class="line">        for (let i = 0; i &lt; suffixs.length; i++) &#123;</span><br><span class="line">          if (suffixs[i].toLowerCase() === suffix) &#123;</span><br><span class="line">            validateSuffix = true;</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!validateSuffix) &#123;</span><br><span class="line">          Toast.warning(&quot;文件格式不正确！只支持上传：&quot; + suffixs.join(&quot;,&quot;));</span><br><span class="line">          $(&quot;#&quot; + _this.inputId + &quot;-input&quot;).val(&quot;&quot;);</span><br><span class="line">          return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 文件分片</span><br><span class="line">        let shardSize = 10 * 1024 * 1024;    //以10MB为一个分片</span><br><span class="line">        let shardIndex = 1;   //分片索引，1表示第1个分片</span><br><span class="line">        let size = file.size;</span><br><span class="line">        let shardTotal = Math.ceil(size / shardSize); //总片数</span><br><span class="line"></span><br><span class="line">        let param = &#123; //&#x27;shard&#x27;: base64,</span><br><span class="line">          &#x27;shardIndex&#x27;: shardIndex,</span><br><span class="line">          &#x27;shardSize&#x27;: shardSize,</span><br><span class="line">          &#x27;shardTotal&#x27;: shardTotal,</span><br><span class="line">          &#x27;use&#x27;: _this.use,</span><br><span class="line">          &#x27;name&#x27;: file.name,</span><br><span class="line">          &#x27;suffix&#x27;: suffix,</span><br><span class="line">          &#x27;size&#x27;: file.size,</span><br><span class="line">          &#x27;key&#x27;: key62</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        _this.check(param);</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<p>执行结果出了一大堆错误，见图<img src="https://img.mukewang.com/szimg/6043216209005bbb10510493.jpg" alt="图片描述"></p>
<p>请问老师，上述改写的思路对吗？<br>还有，为什么程序执行时会先执行big-file.vue 第97行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&quot;key62:&quot;, key62);</span><br></pre></td></tr></table></figure>

<p>然后才执行big-file.vue 第63行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(key, key10, key62);</span><br></pre></td></tr></table></figure>

<p>麻烦老师指点一下我如何实现同一文件更改了文件名后再次上传后也可以极速上传，（问题有点多且零散，麻烦老师逐一解答）。</p>
</blockquote>
<blockquote>
<ol>
<li>本文最初所提的问题 中的解决思路 可行吗？我觉得我的思路是可行的，因为linux 中的 sha256sum， md5sum 命令不也是基于同样的原理吗？ </li>
<li>为什么会先执行第97行的代码然后才执行第63行的代码？ </li>
<li>file这个对象没有什么属性可以用，有其他的办法吗？</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p><code>回答</code>1:</p>
<ul>
<li><ol>
<li>读你这个代码片段，看不出来思路，你是想整个文件内容传到后端去校验重复？这样check方法得改，原来我只是传一个字符串，不支持传一个对象</li>
<li>63是在onload里，只是定义加载到文件后，会去执行里面的内容，不是代码走到onload就马上执行里面的function，而且加载文件是要一段时间的 </li>
<li>lastModified就是最后更新时间，我觉得把key的计算变成lastModified+size+type就挺好的，其它都不用动</li>
</ol>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<p><code>自答</code>：</p>
<p>截图：</p>
<img src="https://img.mukewang.com/szimg/60459d1d09482a9a05000353.jpg" alt="https://img.mukewang.com/szimg/60459d1c092cb07110650750.jpg" style="zoom:150%;" />

<img src="https://img1.sycdn.imooc.com/szimg/60459d1d09fa35c105000282.jpg" alt="https://img1.sycdn.imooc.com/szimg/60459d1c097390f513750775.jpg" style="zoom:150%;" />

<p>这是console.log(“file:”, file);</p>
<p>的输出截图：</p>
<img src="https://img.mukewang.com/szimg/60459e5c09231f1f05000136.jpg" alt="https://img.mukewang.com/szimg/60459e5c094bba6d05740155.jpg" style="zoom:150%;" />
</blockquote>
</blockquote>
<blockquote>
<p><code>追加问题</code>：</p>
<p>我这在他的问题基础上想问一下</p>
<ul>
<li><p>1.同内容不同文件名的两个文件，转成Base64后会一样吗？ 如 1.MP4 和 2.MP4 同一个文件，只修改文件名</p>
</li>
<li><p>2.同一个文件复制出两个文件，一个为1.MP4 一个 为1.avi 还是视频格式，但是文件后缀不同</p>
</li>
<li><p>3.同2后缀不同，但是另一个是视频格式以外的格式，如txt，jpg之类的</p>
</li>
</ul>
</blockquote>
<h1 id="第11章"><a href="#第11章" class="headerlink" title="第11章"></a>第11章</h1><h2 id="11-1-增加用户管理功能"><a href="#11-1-增加用户管理功能" class="headerlink" title="11-1 增加用户管理功能"></a>11-1 增加用户管理功能</h2><h3 id="Q1：自定义业务抛错问题"><a href="#Q1：自定义业务抛错问题" class="headerlink" title="Q1：自定义业务抛错问题"></a>Q1：自定义业务抛错问题</h3><blockquote>
<p><code>描述</code>：</p>
<pre><code>@Override
</code></pre>
<p>public synchronized Throwable fillInStackTrace() {<br>return this;<br>}<br>老师：你好，idea默认重写的是带synchronized修饰的，您这边是这么写的没有带synchronized修饰，有区别么？<br>@Override<br>public synchronized Throwable fillInStackTrace() {<br>return this;<br>}</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>fillInStackTrace主要是用来填充堆栈信息的，也就是我们经常看到的一大堆的报错，我们的业务这里是不需要的，所以重写fillInStackTrace，而fillInStackTrace是synchronized，这个是线程同步，就是保证我打印出来的堆栈信息都是我当前线程的，报错信息不会乱窜。synchronized都是比较耗时的。</p>
<p>我们这里不需要打印堆栈信息，也不需要加线程同步synchronized</p>
</blockquote>
<h3 id="Q2：关于用户管理的逻辑"><a href="#Q2：关于用户管理的逻辑" class="headerlink" title="Q2：关于用户管理的逻辑"></a>Q2：关于用户管理的逻辑</h3><blockquote>
<p><code>描述</code>：老师你好，我有点没太明白这个用户管理的逻辑</p>
<ul>
<li>一开始是开发了验证用户名的function，通过service去数据库里检查这个用户名是否存在。那是不是应该用户名存在才不能insert（新增用户）呢？为什么是用户信息存在反而可以insert</li>
<li>我有一些后端基础但是没有学过前端，所以vue那块看起来稍有点吃力，也不是很明白为什么突然就有那个登录框了<br>我自己理解的逻辑应该是“路由中开发一个登录页面&#x2F;login，然后访问其他任何页面时先登录验证，如果没有登录先跳转到这个&#x2F;login完成登录。不知道这边是不是这个逻辑呀？</li>
<li>另外不是很明白为什么会有&#x2F;system&#x2F;user里右上角那个打开可以修改密码的框，这个是什么作用啊？用来修改昵称和密码吗</li>
</ul>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ol>
<li><p>可以看下我课程的代码，如果userDb不为空，表示已存在，就抛异常，跟你说的是一致的<img src="https://img.mukewang.com/szimg/5ee435a1095f3adf05000233.jpg" alt="https://img.mukewang.com/szimg/5ee435a0096ba60508360388.jpg"></p>
</li>
<li><p>你说的是对的，未登录的就跳到登录页面，不知道你是不是跟着课程看的，还是直接看的这一章。vue的路由跳转在前面的章节有介绍</p>
</li>
<li><p><strong>用户的编辑（包括昵称等，实际可能还有邮箱，手机号）和密码的编辑是分开的</strong>，对应两个弹出框</p>
</li>
</ol>
</blockquote>
<h3 id="Q3：密码校验问题"><a href="#Q3：密码校验问题" class="headerlink" title="Q3：密码校验问题"></a>Q3：密码校验问题</h3><blockquote>
<p><code>描述</code>：检验用户密码时，为什么不能把123传递到后端，然后后端 MD5(123) 是否等同于 数据库password，这样的形式来判断呢，为什么非要在前端MD5(123)呢，这样前端的算法不久容易被查看出来吗。</p>
</blockquote>
<blockquote>
<p><code>回答</code>：	<strong>密码明文传输非常危险。</strong></p>
<p>以前有移动基站或免费wifi的骗局就会利用这一点，比如你连了个免费wifi，你登录了什么网站，传输了什么用户名、密码都会被对方的路由器记录。密码就泄露了。</p>
<p>md5一般加盐值就很难破，也可以采用其它加密算法，比如sha256。</p>
<p>以前有移动基站或免费wifi的骗局就会利用这一点，比如你连了个免费wifi，你登录了什么网站，传输了什么用户名、密码都会被对方的路由器记录。密码就泄露了。</p>
<p>md5一般加盐值就很难破，也可以采用其它加密算法，比如sha256。</p>
<blockquote>
<p>追问：但是https网站也能被截获密码吗，因为前端定义算法，人家黑客可以直接打开网站源代码，看到前端代码和salt码把。</p>
<p><em>回答：</em><u>不是看网站的源码</u>，而是<u>看发起的请求的地址和传输的数据</u>。就像你按F12，在开发工具里能看到你每次请求的地址，传输的参数等。比如黑客能看到你访问了imooc.com，用aaa&#x2F;bbb登录。黑客就可以访问imooc.com，用aaa&#x2F;bbb登录，看看你的账号里有什么东西。如果你登录的是银行、支付宝等，就危险了</p>
</blockquote>
</blockquote>
<h3 id="Q4：DTO类返回问题"><a href="#Q4：DTO类返回问题" class="headerlink" title="Q4：DTO类返回问题"></a>Q4：DTO类返回问题</h3><blockquote>
<p>前后端的数据传输字段比较多变，用User类的话不合适，因为数据库实体类一般和数据库字段对应，不能灵活多变。可以把DTO拆成两层，请求的定义一层，把返回的也定义一层</p>
</blockquote>
<h3 id="Q5：关于事务注解的问题"><a href="#Q5：关于事务注解的问题" class="headerlink" title="Q5：关于事务注解的问题"></a>Q5：关于事务注解的问题</h3><blockquote>
<p><code>描述：</code></p>
<p>一般涉及到数据的增删改操作的时候，不应该要在事务方法上添加@Transactional注解吗。但是如果把方法定义成私有访问的时候，注解就添加不了，估计是因为只能通过内部来调用增改操作，不允许其他方法外的接口来调用。但是不添加事务回滚业务的话，在捕获异常代码之后出现错误情况，不会出现数据异常的情况吗？</p>
<p><img src="https://img1.sycdn.imooc.com/szimg/5f1541790823a1be05000245.jpg" alt="https://img1.sycdn.imooc.com/szimg/5f15417908c8be6509810480.jpg"></p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>在第7章我有关于对事务的介绍，可以回看一下。我有介绍，同一个类里A方法调用B方法，B方法加事务是不生效的。</p>
<p>insert和update不需要加事务，不暴露给外部调用，可以在外层的save方法里加。</p>
</blockquote>
<h3 id="关于CourseDto的问题？"><a href="#关于CourseDto的问题？" class="headerlink" title="关于CourseDto的问题？"></a>关于CourseDto的问题？</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://coding.imooc.com/learn/questiondetail/Z85pz6GARekYn0rV.html">关于分页</a></p>
</blockquote>
<h3 id="Q6：邮箱注册？"><a href="#Q6：邮箱注册？" class="headerlink" title="Q6：邮箱注册？"></a>Q6：邮箱注册？</h3><blockquote>
<p><code>描述</code>：请教一个问题？<br>用户如果选择邮箱注册的话，请问老师，后端通过什么方式来实现邮箱注册功能呢？</p>
<ol>
<li>公司首先在QQ,或者是网易，阿里云上注册一个公司企业邮箱，后端代码实现登录该邮箱并自动发送验证码或激活链接的邮件到用户邮箱上。</li>
<li>购买阿里云的 “邮件推送”服务，与老师你的VOD,OSS服务类似，通过调用阿里云的api来实现自动发送包含验证码或激活链接的邮件到用户邮箱</li>
<li>其他</li>
</ol>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ol>
<li><p>这种方式会普遍一点，但是不是登录邮箱，而是QQ或网易本身提供了SMTP服务，网上这种代码有很多，可以百度下</p>
</li>
<li><p>阿里云的“邮件推送”服务，我没用过，应该是收费的吧。想稳定一点，就用这种</p>
</li>
</ol>
</blockquote>
<h2 id="11-2-密码的加密传输与存储"><a href="#11-2-密码的加密传输与存储" class="headerlink" title="11-2 密码的加密传输与存储"></a>11-2 密码的加密传输与存储</h2><h3 id="Q1：重置密码的相关问题"><a href="#Q1：重置密码的相关问题" class="headerlink" title="Q1：重置密码的相关问题"></a>Q1：重置密码的相关问题</h3><blockquote>
<p><code>描述</code>:	</p>
<p><img src="https://img.mukewang.com/szimg/5ebe93f609aa421e17460883.jpg" alt="图片描述"><br><img src="https://img1.sycdn.imooc.com/szimg/5ebe9d2b090c3bfc11420250.jpg" alt="图片描述"><br>老师，你好<br>问题一：请问重置密码这种业务操作，如果插入数据库失败，用哪种方式抛出去给前端更好？<br>我这里第一种想法是直接返回相关错误，第二种想法是抛出异常，然后拦截再抛出去。</p>
<p>问题二：什么时候应该直接抛出异常？什么时候应该直接返回错误？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>都可以的。如果你把ResponseVo，传到了service层，那么出错时就可以直接构造ResponseVo返回值，不需要抛异常。</p>
<p>反之，比如登录功能，我在service层的返回值是当前登录的用户，即返回LoginUserDto，这种情况，出错时没法返回ResponseVo，只能抛异常，然后由统一异常处理成ResponseVo，再返回给前端</p>
</blockquote>
<h3 id="Q2：密码规则校验问题"><a href="#Q2：密码规则校验问题" class="headerlink" title="Q2：密码规则校验问题(***)"></a>Q2：密码规则校验问题(***)</h3><blockquote>
<p><code>描述</code>：密码规则校验问题</p>
<p>如果要做密码规则校验功能，密码在前台MD5加密后，后台如何判断密码规则是否包含了大小写字母、数字、特殊符号</p>
<blockquote>
<p><code>回答</code>：余着		</p>
</blockquote>
</blockquote>
<h3 id="Q3-js全局变量"><a href="#Q3-js全局变量" class="headerlink" title="Q3:js全局变量"></a>Q3:js全局变量</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师,本课中,为什么user.vue中可以直接使用全局变量KEY,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hex_md5(_this.user.password + KEY);</span><br></pre></td></tr></table></figure>

<p>我记得你以前在写 course.vue时, 写下面的这一句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">return &#123;</span><br><span class="line">        course: &#123;&#125;, </span><br><span class="line">        FILE_USE: FILE_USE,  </span><br><span class="line">        saveContentLabel: &quot;&quot;,</span><br><span class="line">        files: [],</span><br><span class="line">        saveContentInterval: &#123;&#125;,</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>时,讲到类似的意思,如果我复述有误,请指出,</p>
<p>这里的第一个FILE_USE表示在Vue定义一个名为FILE_USE数据成员变量，而<code>:</code>后的那个FILE_USE表示的是enums.js中的全局变量FILE_USE,该全局变量所有文件都可见，但vue中不能直接使用该全局变量，只能使用数据成员变量，因此，需要定义一个数据成员变量FILE_USE，所以，FILE_USE: FILE_USE表示用全局变量FILE_USE初始化数据成员变量FILE_USE.</p>
<p>请问, 老师, 为什么这里的 user.vue 又可以直接使用 KEY 呢?</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>vue的html代码里（template标签内部）不能使用js的全局变量，但是js部分（script标签内部）是可以的，所以要在html里用到FILE_USE，就得先在script定义一个vue组件变量。同理，user.vue里js代码当然可以直接用KEY</p>
</blockquote>
<h2 id="11-3-基本的登录功能开发"><a href="#11-3-基本的登录功能开发" class="headerlink" title="11-3 基本的登录功能开发"></a>11-3 基本的登录功能开发</h2><h3 id="Q1：vue中的data-function"><a href="#Q1：vue中的data-function" class="headerlink" title="Q1：vue中的data:function"></a>Q1：vue中的data:function</h3><blockquote>
<p>老师,像本节中,新增的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data: function() &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    user: &#123;&#125;, //老师,一般在什么情况下需要在此定义变量</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>在这个位置定义的变量是不是就跟 在 java 类中定义一个 公有的成员变量 一样,起到相同的作用?</p>
</blockquote>
<blockquote>
<p><code>回答</code>：有点类似，这个就是当前组件内的变量，如果你在html代码或js代码中要用到变量，就可以在data里定义</p>
</blockquote>
<h2 id="11-4-退出登录与记住功能"><a href="#11-4-退出登录与记住功能" class="headerlink" title="11-4 退出登录与记住功能"></a>11-4 退出登录与记住功能</h2><h3 id="Q1：前后端分离登录"><a href="#Q1：前后端分离登录" class="headerlink" title="Q1：前后端分离登录"></a>Q1：前后端分离登录</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师您好，前后端分离的话会话都是无状态的，那么退出登录的话（logout）方法，request.getSession().setAttribute(“loginUser”,null)还有意义吗？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：我课程中的代码是这样，redisTemplate.delete(token);</p>
<p>是从公共缓存redis中删除登录信息，这个是必须的，否则你的token还是有效的，别人拿你的token依然可以调服务器接口</p>
</blockquote>
<h3 id="Q2：teacher-vue照片重叠"><a href="#Q2：teacher-vue照片重叠" class="headerlink" title="Q2：teacher.vue照片重叠"></a>Q2：teacher.vue照片重叠</h3><blockquote>
<p><code>描述</code>：</p>
</blockquote>
<blockquote>
<p><code>回答</code>：这个是因为引入aliplayer的样式，出现样式冲突了</p>
</blockquote>
<hr>
<h2 id="11-5增加登录图形验证码"><a href="#11-5增加登录图形验证码" class="headerlink" title="11-5增加登录图形验证码"></a>11-5增加登录图形验证码</h2><h3 id="Q1：简单说下目前为止登录的流程"><a href="#Q1：简单说下目前为止登录的流程" class="headerlink" title="Q1：简单说下目前为止登录的流程"></a>Q1：简单说下目前为止登录的流程</h3><blockquote>
<p><code>答</code>：前端生成ImagCodeToken（即在<code>login.vue</code>中初始化中调用loadImageCode()方法获得一个8位的token），<u>前端的token只是验证码的一个标识，后端根据该8位的toekn生成真正的验证码，并存到session中，之后生成图片以一个连接的方式显示</u></p>
<ul>
<li>前端输入验证码后，带上token和输入的验证码，请求给后端</li>
<li>后端在<code>\system\admin\user\login</code>接收请求，并通过前端传过来的参数——<u>user</u>中的验证码（imageCodeToken）从会话中获取对应的验证码并再与前端的<code>imageToken</code>进行比较。</li>
</ul>
</blockquote>
<h3 id="Q2：验证码过期问题"><a href="#Q2：验证码过期问题" class="headerlink" title="Q2：验证码过期问题?"></a>Q2：验证码过期问题?</h3><blockquote>
<p><code>描述</code>：我打印出来了两个sessionId 的确不一致，重启 6 个服务也试过， 修改的文件与老师的文件也比较过，都没有发现有什么问题，见图：<br><img src="https://img1.sycdn.imooc.com/szimg/5f4f6efd0994233315610755.jpg" alt="图片描述"></p>
<p>会不会是新版本的vue造成的，我与老师的不同点应该就是vue的版本号了，其它的我想不出来还有什么不同的地方？</p>
<p>$ vue -V<br>@vue&#x2F;cli 4.4.6</p>
</blockquote>
<blockquote>
<p><code>回答</code>：Chrome 51 开始，浏览器的Cookie新增加了一个SameSite属性，用来防止CSRF攻击和用户追踪。Chrome升级到80版本后，默认限制了cross-site携带cookie，导致cookie失效.</p>
<p>解决办法：</p>
<p>直接在地址栏里输入chrome:&#x2F;&#x2F;flags </p>
<p>然后在搜索框里搜索关键字SameSite,找到与之匹配的项SameSite by default cookies 将其设置为Disabled</p>
<p>详情见这个经验<a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/c45ad29cefe95e441653e227.html">https://jingyan.baidu.com/article/c45ad29cefe95e441653e227.html</a></p>
</blockquote>
<h2 id="11-6-关于登录的问题"><a href="#11-6-关于登录的问题" class="headerlink" title="11-6 关于登录的问题"></a>11-6 关于登录的问题</h2><h3 id="Q1：前端从loginDto中获取到token后，是怎么实现可以用这个token去访问"><a href="#Q1：前端从loginDto中获取到token后，是怎么实现可以用这个token去访问" class="headerlink" title="Q1：前端从loginDto中获取到token后，是怎么实现可以用这个token去访问"></a>Q1：前端从loginDto中获取到token后，是怎么实现可以用这个token去访问</h3><blockquote>
<p><code>描述</code>：前端从loginDto中获取到token后，是怎么实现可以用这个token去访问其他相关网站的呢？ 是不是前端后续的url都带有token，然后后端获取token去redis中取得相应的用户信息，再返回给前端用于登录其他关联的网站？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：登录成功后，前端拿到token，所有请求都要带上token，要保护好token，这就是通行证。</p>
<p>比如你登录了淘宝，淘宝会个token到前端，然后你从淘宝跳转到支付宝，这时会带上token，支付宝会验证这个token，有效，那就不用登录了，这个就是单点登录。</p>
<p>登录的时候是往redis里存token和用户信息，验证的时候是通过token去redis取用户信息，能取到就是验证通过</p>
</blockquote>
<h3 id="Q2：单点登录的问题"><a href="#Q2：单点登录的问题" class="headerlink" title="Q2：单点登录的问题"></a>Q2：单点登录的问题</h3><blockquote>
<p>Getmapping (“login &#x2F;{token}”)中{token}是啥意思 是路径吗？</p>
<p><code>回答</code>：类似于占位符</p>
</blockquote>
<blockquote>
<p><code>描述</code>：用ThreadLocal支持分布式单点登陆吗？ThreadLocal比redis好吗。</p>
<p>&#x2F;&#x2F;使用ThreadLocal，可以隔离每个线程的数据，为每一个线程创建数据副本，各个用户的数据不会混乱<br>private static ThreadLocal&lt;Map&lt;String,Object&gt;&gt; threadLocal &#x3D; new ThreadLocal&lt;&gt;();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置user值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(User user,Integer scope)</span>&#123;</span><br><span class="line">   <span class="comment">// LocalUser.user = user;</span></span><br><span class="line">    Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">    map.put(<span class="string">&quot;scope&quot;</span>,scope);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把包含用户信息和权限的HashMap，保存到threadLocal中</span></span><br><span class="line">    LocalUser.threadLocal.set(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ul>
<li><p>ThreadLocal不能用来保存登录信息，你也写了，用来每个线程隔离信息。我登录完成后，登录这个线程就释放了，这个变量就没有了。</p>
<p>一般用在并发场景时，需要每个线程各自存一些临时数据，可以用到。</p>
<p>并且对分布式不适用。ThreadLocal只在本机本线程有效</p>
</li>
<li><p>redis本身就是分布式缓存，适合用来存储登录信息</p>
</li>
</ul>
</blockquote>
<h3 id="Q3-主键ID问题"><a href="#Q3-主键ID问题" class="headerlink" title="Q3:主键ID问题"></a>Q3:主键ID问题</h3><blockquote>
<p><code>描述</code>：	如何生成类似抖音用户ID，QQ号码等，非连续，易于记忆的分布式，数字业务主键ID。</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>有一种设计，专门设置一张序列号表，可以提前生成100个号，每次有新用户时，就随机取1个号，还剩50个的时候，再生成100个号</p>
</blockquote>
<h3 id="Q4：Redis取代Session？"><a href="#Q4：Redis取代Session？" class="headerlink" title="Q4：Redis取代Session？"></a>Q4：Redis取代Session？</h3><blockquote>
<p><code>描述</code>：</p>
<p>老师，本节中用redis来取代session共享，保存验证码token 和 验证码，而且，老师你在本节中也讲到用redis有两个优点，</p>
<ul>
<li>既然如此的话，是不是没有只能用session的特定场合</li>
<li>（即所有用session的场合都可以用并且建议用 redis 来取代，没有例外）？</li>
</ul>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p>​	是的，有一个概念叫做无状态应用，可以了解下。一般不在应用服务器内存一些特定的值，这样就会让应用变成有状态。</p>
<p>无状态的好处是我可以随时为应用增加或减少机器，而不影响用户使用。比如搞秒杀活动时，我可以从原来2节点变成10节点，以应对短时高流量，秒杀结束后再降为2节点，降低成本。不管是2节点还是10节点，这些应用都是无状态的，一个请求不管走到哪个节点，请求结果都是一样的。</p>
</blockquote>
<h3 id="Q5：如何区分token和sessionId？"><a href="#Q5：如何区分token和sessionId？" class="headerlink" title="Q5：如何区分token和sessionId？"></a>Q5：如何区分token和sessionId？</h3><blockquote>
<p><code>描述</code>：开始是问认证机制以及判断不同认证机制的理由？ 	最后延申到用户数据需要和第三方共享，或者允许第三方调用API接口？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ul>
<li><p>先参考下这个文章<a target="_blank" rel="noopener" href="https://juejin.cn/post/7028091738791084039">详解Session、Token、JWT 、OAuth2</a></p>
</li>
<li><p>token跟session不是一个性质的东西，不能比较。</p>
<ul>
<li>token是一串唯一字符串，用于验证是否登录的一串标识。</li>
<li>session是用来存会话数据的，是本机的一个内存存储空间。</li>
</ul>
</li>
<li><p>token和sessionId，</p>
<ul>
<li>一般一个会话进来，服务端就会生成一个sessionId，并开辟一个会话空间让你可以存数据，</li>
<li>我们项目没用session保存数据，所以sessionId也相当于没用，我们用的是redis保存数据。token的规则是我们可以自定义的，sessionId是服务端自动生成的，我们项目用的是token。</li>
</ul>
</li>
<li><p>如果你的用户数据可能需要和第三方共享，或者允许第三方调用 API 接口，用 Token 。如果永远只是自己的网站，自己的 App，用什么就无所谓了。</p>
<ul>
<li>&#96;&#96;&#96;markdown<br>可以的，我们做出来也是个单点登录功能，比如你从wiki做了个菜单，跳到另一个系统，比如博客系统，这时，可以在跳转参数里带上token，博客系统的所有请求都带上token(和wiki带一样的token)，后端就认为博客系统也已经登录了，可以支持任何增删改查操作<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### Q6:关于从gateway获取所有的token</span><br><span class="line"></span><br><span class="line">`描述`：	如果我想获得 当前用户，也就是其他模块 想获得 gateway拦截到的 token</span><br><span class="line">怎么实现呢？</span><br><span class="line"></span><br><span class="line">- 日志模块AOP如何获取token？</span><br><span class="line"></span><br><span class="line">`回答`：</span><br><span class="line"></span><br><span class="line">- 在controller方法里增加HttpServletRequest request参数，就能使用request，其它写法跟gateway一样，也是从headers里获取</span><br><span class="line">- 可以按LogAspect类，写一个自己的AOP类，`String token = request.getHeader(&quot;token&quot;);`</span><br><span class="line"></span><br><span class="line">### Q7:关于验证码加载不出来的问题</span><br><span class="line"></span><br><span class="line">参考[解决Redis报错Redis is configured to save RDB snapshots, but it is currently not able to persist on disk](https://cloud.tencent.com/developer/article/1600527)</span><br><span class="line"></span><br><span class="line">起来是靠命令`config set stop-writes-on-bgsave-error no`,但治标不治本，重启了还是个鸟样</span><br><span class="line"></span><br><span class="line">最后还是要靠 卸载Redis在widows的服务来实现的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 11-7 前后端登录拦截</span><br><span class="line"></span><br><span class="line">### Q1:Interceptor拦截器的问题</span><br><span class="line"></span><br><span class="line">`描述`：</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>@Slf4j<br>public class UserLoginInterceptor implements HandlerInterceptor {</p>
<pre><code>@Resource
StringRedisTemplate stringRedisTemplate;

/**
 * true 表示继续流程，false表示中断
 * @param request
 * @param response
 * @param handler
 * @return
 * @throws Exception
 */
@Override
public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;
    log.info(&quot;preHandle...&quot;);
    String token = request.getHeader(&quot;token&quot;);
    if (StringUtils.isEmpty(token)) &#123;
        log.info(&quot;token为空，请求被拦截&quot;);
        throw new BusinessException(&quot;token为空，请求被拦截了&quot;);
    &#125;

    String redisToken = null;
    try &#123;
        redisToken = stringRedisTemplate.opsForValue().get(token);
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
    &#125;
    if (redisToken == null) &#123;
        log.error(&quot;token无效， 请求被拦截&quot;);
        throw new BusinessException(&quot;token无效， 请求被拦截&quot;);
    &#125; else &#123;
        log.info(&quot;已登录: &#123;&#125;&quot;, redisToken);
    &#125;
    return true;
&#125;
</code></pre>
<p>}<br>@Configuration<br>public class InterceptorConfig implements WebMvcConfigurer {</p>
<pre><code>// TODO exclude路径在配置文件读取
@Override
public void addInterceptors(InterceptorRegistry registry) &#123;
    registry.addInterceptor(new UserLoginInterceptor())
            .addPathPatterns(&quot;/**&quot;)
            .excludePathPatterns( &quot;/system/admin/user/login&quot;, &quot;/system/admin/user/logout&quot;,
                    &quot;/system/admin/kaptcha&quot;);
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![图片描述](https://img1.sycdn.imooc.com/szimg/5ec197d0098cfd4913460471.jpg)</span><br><span class="line"></span><br><span class="line">前端输出</span><br><span class="line">![图片描述](https://img.mukewang.com/szimg/5ec1989d095275ce12940346.jpg)</span><br><span class="line"></span><br><span class="line">后端输出：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>22.538 ERROR c.c.s.i.UserLoginInterceptor  :47   token无效， 请求被拦截</p>
<pre><code>
想用另一种方法实现用户拦截，这是我写的拦截器，在server模块，逻辑跟过滤器一样，从后端的返回值和日志看拦截像是成功了。
但是不知道为什么前端页面还是能读取到静态的资源。
Interceptor拦截器能不能代替过滤器？
</code></pre>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ul>
<li><p>拦截器和过滤器都可以的。目的都是在业务代码之前拦截到，并做权限判断。静态资源不会被拦截，你可以在vue的拦截器里增加判断（前端统一打印日志的地方），如果后端返回的是未登录，那么就跳转到登录页面</p>
</li>
<li><p>if (response.data.status !&#x3D; 0) { router.push(‘&#x2F;login’); } 在拦截器里加了跳转的代码。。的确可以实现跳转了，但是直接访问&#x2F;system&#x2F;user的话，会有个不知道算不算的bug的bug，会先看到system&#x2F;user的静态资源（一闪而过然后转到login）。</p>
<ul>
<li>在权限管理那章，会介绍vue路由的拦截，就不会有这个问题，可以往后看</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Q2：登录拦截功能，如果请求不走网关就拦截不到的问题"><a href="#Q2：登录拦截功能，如果请求不走网关就拦截不到的问题" class="headerlink" title="Q2：登录拦截功能，如果请求不走网关就拦截不到的问题"></a>Q2：登录拦截功能，如果请求不走网关就拦截不到的问题</h3><blockquote>
<p><code>描述</code>：使用第三方插件（postman），直接访问system模块，就越过了网关的登录拦截，怎么限制system模块的接口 只能通过网关来请求</p>
<ul>
<li>会在部署的是时候解决</li>
</ul>
</blockquote>
<h3 id="Q3-关于vue-router-登录验证和后端登录验证的区别"><a href="#Q3-关于vue-router-登录验证和后端登录验证的区别" class="headerlink" title="Q3:关于vue -router 登录验证和后端登录验证的区别"></a>Q3:关于vue -router 登录验证和后端登录验证的区别</h3><blockquote>
<p><code>描述</code>：</p>
<ol>
<li>为什么这里vue router 查找是否有login info 是在本地缓存 而不是在redis中呢？ localstorage不是仅仅用于remember me 时才保存登录信息嘛？(又复习了一下代码，TOOL也是去session里看是否有登录信息，这个session是没有放入redis的本地session吗？不然后端也是从redis中获取信息验证，感觉和前端的验证就没有区别呀）</li>
<li>所以单点登录中利用token获取是否登录的这个验证，是在gateway的filter中实现的是嘛？ 只有通过了gateway的filter，才能转发到对应路由？</li>
</ol>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ol>
<li>前端的缓存，是指h5的缓存，跟redis没关系，你可以理解成是浏览器开辟了块空间，临时存些网站的数据</li>
<li>对的，是在gateway中验证登录。有很多通用的功能都会放到路由模块，比如登录校验，后面还有权限校验。其它项目可能还有接口验签、限流等都会放到路由中</li>
</ol>
</blockquote>
<h3 id="11-9作业：在创建用户时，能否直接选择角色"><a href="#11-9作业：在创建用户时，能否直接选择角色" class="headerlink" title="11-9作业：在创建用户时，能否直接选择角色"></a>11-9作业：在创建用户时，能否直接选择角色</h3><blockquote>
<p><code>描述</code>：</p>
<p>现在在用户管理页面创建用户后，得跳到角色管理，为用户分配角色，能否把这两步并成一步呢，在创建用户的时候，直接就选择角色</p>
<p><code>难度</code>：✩</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<p><strong>思路点拨：</strong></p>
<ol>
<li>在用户管理页面，需要查出所有的角色</li>
<li>用户表单，需要增加角色选择框</li>
<li>保存时前后端传参需要增加角色</li>
<li>后端保存用户后，直接保存用户角色表</li>
<li>最终落库和现在无异</li>
</ol>
</blockquote>
<blockquote>
<p><strong>回答2</strong>：</p>
<pre><code>1. 前端：可以增加角色选择框，data中添加角色`&#123;&#125;`对象
1. ~~：mounted页面渲染时，调用获取角色列表方法
1. ~~：将获取到的角色列表&#123;&#125;绑定到角色选择框
1. 后端：编写获取角色列表接口，增加`userRoleDto`。
</code></pre>
</blockquote>
<h3 id="11-10-如何实现邮箱注册功能"><a href="#11-10-如何实现邮箱注册功能" class="headerlink" title="11-10 如何实现邮箱注册功能"></a>11-10 如何实现邮箱注册功能</h3><blockquote>
<p><code>描述</code>：</p>
<p>课程中带大家实现了手机短信注册的功能，那么如何实现邮箱注册功能呢？</p>
</blockquote>
<blockquote>
<p><code>思路点拨</code>：</p>
<p>邮箱注册主要是要验证邮箱的有效性，而不是随便填都能注册，有效性验证有两种思路:</p>
<ol>
<li>和课程一样，使用验证码的方法，表结构设计，代码流程和手机号注册基本一致<br>使用激活链接</li>
<li>注册时填入邮箱密码，不需要验证，直接注册成功，会员状态是未激活</li>
<li>系统发送激活链接到注册的邮箱里   (此链接接口返回的估计就是<u>true或flase</u>)</li>
<li>会员点击激活链接，会员状态变为已激活</li>
<li>数据库表不需要存储验证码了，但要换成存储激活链接</li>
</ol>
</blockquote>
<h1 id="第12章"><a href="#第12章" class="headerlink" title="第12章"></a>第12章</h1><h2 id="12-1-通用权限方案"><a href="#12-1-通用权限方案" class="headerlink" title="12-1 通用权限方案"></a>12-1 通用权限方案</h2><h3 id="Q1-权限问题？"><a href="#Q1-权限问题？" class="headerlink" title="Q1:权限问题？"></a>Q1:权限问题？</h3><blockquote>
<p><code>描述</code>：后端的权限挂历一般在springcloud微服务架构里是放网关里，还是单独创建个client子服务？</p>
</blockquote>
<blockquote>
<p><code>回答</code>：如果项目不是很大，一般放gateway就可以，减少复杂度，减低维护成本。如果项目勾搭，也可以做成单独的鉴权模块。</p>
</blockquote>
<h3 id="Q2-system模块和business模块的区别"><a href="#Q2-system模块和business模块的区别" class="headerlink" title="Q2:system模块和business模块的区别"></a>Q2:system模块和business模块的区别</h3><blockquote>
<p><code>描述</code>：系统模块和业务模块有什么本质区别？<u>为什么对于课程、讲师、会员的管理都防砸ibusiness，而资源、角色和用户这些放在系统模块里？</u></p>
</blockquote>
<blockquote>
<p><code>回答</code>：应为这两块的功能不太相关，所以放在不同的模块，作为不同的服务，</p>
<p><strong>微服务就是</strong><u>将不同的功能放在不同的模块。</u>	<em>实际项目中根据不同的项目，会建不同的模块，比如支付模块、库存模块、<u>跑批模块</u>等。</em></p>
</blockquote>
<h3 id="Q3：session，cookie，token的区别"><a href="#Q3：session，cookie，token的区别" class="headerlink" title="Q3：session，cookie，token的区别"></a>Q3：session，cookie，token的区别</h3><blockquote>
<p><code>描述</code>：本质区别</p>
</blockquote>
<blockquote>
<p><code>回答</code>：</p>
<ul>
<li><code>session</code>是会话，是存储在服务器端，<u>有一个用户访问网站，服务器就会开辟一个本地空间来保存session信息。</u><em>比如sessionId，登录信息等，可以自定义保存各种会话相关的信息。</em></li>
<li><code>cookie</code>是客户端浏览器上的，也是用来保存各种自定义信息，不过容量小，现在被h5的缓存替代了，就是课程中用到的<code>localStorage</code>和<code>sessionStorage</code>，cookie一般用不到了</li>
<li><code>token</code>是<strong>登录的标识</strong>，是我们自己定义的一种业务信息，可以存到session、cookie、h5缓存、redis，即<u>可以根据业务的需求来灵活地生成和存放</u>。</li>
</ul>
</blockquote>
<h3 id="Q4-注解-EnableScheduling-以及-多环境打包"><a href="#Q4-注解-EnableScheduling-以及-多环境打包" class="headerlink" title="Q4:注解@EnableScheduling  以及 多环境打包"></a>Q4:注解@EnableScheduling  以及 多环境打包</h3><blockquote>
<p><code>描述</code>：</p>
<blockquote>
<p><strong>请教老师 这个注解@EnableScheduling 可以放在Service类或者impl类吗？</strong></p>
<p>@EnableScheduling<br>public interface TestService {}</p>
<p>或者<br>@EnableScheduling<br>@Service<br>public class TestServiceImpl implements TestService {}</p>
<blockquote>
<p><code>回答</code>：这个是一次性的配置，一般放在启动类，或是@Configuration的类，比如这样</p>
<p><img src="https://img1.sycdn.imooc.com/szimg/5f35f98609cca11d03870110.jpg" alt="https://img1.sycdn.imooc.com/szimg/5f35f98609cca11d03870110.jpg"></p>
</blockquote>
</blockquote>
<hr>
<p><code>描述</code>：</p>
<blockquote>
<p>springboot 多模块中因为代码有依赖，而且整个多模块中有多个访问地址+端口 比如有 <a target="_blank" rel="noopener" href="http://localhost:8081/">http://localhost:8081/</a> <a target="_blank" rel="noopener" href="http://localhost:8082/">http://localhost:8082/</a> <a target="_blank" rel="noopener" href="http://localhost:8083/">http://localhost:8083/</a> 请教老师 如何打成jar包部署？</p>
</blockquote>
<blockquote>
<p>每个模块分别打成一个JAR包，在后面我有演示，可以找十四章多环境打包这一节</p>
</blockquote>
</blockquote>
<h3 id="关于支付"><a href="#关于支付" class="headerlink" title="关于支付"></a>关于支付</h3><blockquote>
<p>这门课程是没有实现支付功能的，那老师你有<strong>考虑出</strong>一门与本门课程配套的<strong>支付功能课程</strong>吗？如果有的话，大概的时间段是什么时候，如果没有的话，有相关的教学视频（最好可以和本课程对接得上）推荐吗？ 谢谢回答！</p>
<blockquote>
<p><code>回答</code>：慕课网有一门专门讲各种支付的，PC支付，移动端支付，你可以看看适合你不。<u>《Java支付全家桶：企业级各类支付手段一站式解决方案》</u></p>
</blockquote>
</blockquote>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Tom leeMin</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://Tom-LiMin.github.io/2022/09/20/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/">https://Tom-LiMin.github.io/2022/09/20/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Tom leeMin</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2022/09/20/%E5%AD%A6%E4%B9%A0%E5%9C%A8%E7%BA%BF%E8%AF%BE%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%94%B6%E9%9B%86%E7%9A%84%E9%97%AE%E9%A2%98/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="在线课程系统学习中的问题">
                        
                        <span class="card-title">在线课程系统学习中的问题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-09-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Tom leeMin
                            
                        </span>
                    </div>
                </div>

                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/09/19/%E6%96%B0%E5%BB%BAmd%E7%9A%84%E7%A4%BA%E4%BE%8B/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="在线课程系统学习中的问题">
                        
                        <span class="card-title">在线课程系统学习中的问题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-09-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Tom leeMin
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">Tom leeMin</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
